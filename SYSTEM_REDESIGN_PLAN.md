# CALE/NCCAOM è€ƒè¯•ç³»ç»Ÿé‡æ–°è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ ç›®å½•
1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚](#æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚)
3. [ç³»ç»Ÿæ¶æ„è®¾è®¡](#ç³»ç»Ÿæ¶æ„è®¾è®¡)
4. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
5. [è®¤è¯ä¸æˆæƒç³»ç»Ÿ](#è®¤è¯ä¸æˆæƒç³»ç»Ÿ)
6. [ç”¨æˆ·è§’è‰²ä¸æƒé™](#ç”¨æˆ·è§’è‰²ä¸æƒé™)
7. [æ•°æ®éš”ç¦»ç­–ç•¥](#æ•°æ®éš”ç¦»ç­–ç•¥)
8. [APIè®¾è®¡](#apiè®¾è®¡)
9. [å‰ç«¯é¡µé¢æµç¨‹](#å‰ç«¯é¡µé¢æµç¨‹)
10. [å®æ–½è·¯çº¿å›¾](#å®æ–½è·¯çº¿å›¾)

---

## ç³»ç»Ÿæ¦‚è¿°

### ç³»ç»Ÿå®šä½
ä¸€ä¸ªæ”¯æŒå¤šè€ƒè¯•ç±»å‹ï¼ˆCALEã€NCCAOMç­‰ï¼‰çš„åœ¨çº¿å­¦ä¹ ä¸è€ƒè¯•å¹³å°ï¼Œæä¾›å®Œæ•´çš„ç”¨æˆ·è®¤è¯ã€é¢˜åº“ç®¡ç†ã€å­¦ä¹ è®¡åˆ’ã€æ¨¡æ‹Ÿè€ƒè¯•ç­‰åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§
- âœ… å¤šç”¨æˆ·ç³»ç»Ÿï¼Œæ¯ä¸ªç”¨æˆ·ç‹¬ç«‹æ•°æ®ç©ºé—´
- âœ… å¤šè€ƒè¯•ç±»å‹æ”¯æŒï¼ˆCALEã€NCCAOMç­‰ï¼‰
- âœ… è§’è‰²æƒé™ç®¡ç†ï¼ˆç®¡ç†å‘˜ã€æ™®é€šç”¨æˆ·ï¼‰
- âœ… å®Œæ•´çš„è®¤è¯æˆæƒä½“ç³»
- âœ… ç”¨æˆ·é—´æ•°æ®å®Œå…¨éš”ç¦»
- âœ… ç®¡ç†å‘˜ç»Ÿä¸€ç®¡ç†é¢˜åº“
- âœ… ç”¨æˆ·è‡ªä¸»ç”Ÿæˆå­¦ä¹ è®¡åˆ’å’Œè€ƒè¯•

---

## æ ¸å¿ƒåŠŸèƒ½éœ€æ±‚

### 1. ç”¨æˆ·ç³»ç»Ÿ
| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| ç”¨æˆ·æ³¨å†Œ | é‚®ç®±+å¯†ç æ³¨å†Œï¼Œé‚®ç®±éªŒè¯ | P0 |
| ç”¨æˆ·ç™»å½• | é‚®ç®±+å¯†ç ç™»å½•ï¼ŒJWT Token | P0 |
| æ‰¾å›å¯†ç  | é‚®ç®±éªŒè¯ç é‡ç½®å¯†ç  | P1 |
| ä¸ªäººä¿¡æ¯ | ä¿®æ”¹æ˜µç§°ã€å¤´åƒã€å¯†ç  | P1 |
| è€ƒè¯•è®¢é˜… | ç”¨æˆ·é€‰æ‹©è®¢é˜…çš„è€ƒè¯•ç±»å‹ | P0 |

### 2. ç®¡ç†å‘˜ç³»ç»Ÿ
| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| ç®¡ç†å‘˜ç™»å½• | ç‹¬ç«‹çš„ç®¡ç†å‘˜è®¤è¯ | P0 |
| é¢˜åº“ç®¡ç† | CRUDé¢˜ç›®ï¼Œæ”¯æŒæ‰¹é‡å¯¼å…¥ | P0 |
| ç”¨æˆ·ç®¡ç† | æŸ¥çœ‹ç”¨æˆ·åˆ—è¡¨ï¼Œåœç”¨/å¯ç”¨ç”¨æˆ· | P1 |
| æ•°æ®ç»Ÿè®¡ | ç”¨æˆ·æ•°é‡ã€é¢˜ç›®æ•°é‡ã€æ´»è·ƒåº¦ | P2 |
| è€ƒè¯•ç±»å‹ç®¡ç† | æ·»åŠ /ç¼–è¾‘è€ƒè¯•ç±»å‹å’Œå¤§çº² | P1 |

### 3. é¢˜åº“ç³»ç»Ÿ
| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| é¢˜åº“æµè§ˆ | æŒ‰è€ƒè¯•ç±»å‹ã€é¢†åŸŸã€éš¾åº¦ç­›é€‰ | P0 |
| é¢˜ç›®è¯¦æƒ… | æŸ¥çœ‹é¢˜ç›®ã€ç­”æ¡ˆã€è§£æ | P0 |
| é¢˜ç›®æœç´¢ | å…³é”®è¯æœç´¢é¢˜ç›®å†…å®¹ | P1 |

### 4. å­¦ä¹ è®¡åˆ’
| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| åˆ›å»ºè®¡åˆ’ | ç”¨æˆ·è‡ªå®šä¹‰å­¦ä¹ è®¡åˆ’ | P0 |
| é¢˜ç›®é€‰æ‹© | ä»é¢˜åº“é€‰æ‹©é¢˜ç›®åŠ å…¥è®¡åˆ’ | P0 |
| è¿›åº¦è·Ÿè¸ª | è®°å½•å­¦ä¹ è¿›åº¦å’Œå®ŒæˆçŠ¶æ€ | P0 |
| è®¡åˆ’ç®¡ç† | ç¼–è¾‘ã€åˆ é™¤ã€æš‚åœè®¡åˆ’ | P1 |

### 5. æ¨¡æ‹Ÿè€ƒè¯•
| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| åˆ›å»ºè€ƒè¯• | æ‰‹åŠ¨é…ç½®æˆ–ä¸€é”®ç”Ÿæˆ | P0 |
| å…¨çœŸæ¨¡æ‹Ÿ | æŒ‰å®˜æ–¹æ ‡å‡†ç”Ÿæˆè€ƒè¯• | P0 |
| è€ƒè¯•ç­”é¢˜ | è®¡æ—¶ã€æ ‡è®°ã€æäº¤ | P0 |
| æˆç»©æŠ¥å‘Š | åˆ†æ•°ã€é”™é¢˜åˆ†æã€çŸ¥è¯†ç‚¹åˆ†æ | P0 |
| è€ƒè¯•å†å² | æŸ¥çœ‹å†å²è€ƒè¯•è®°å½• | P1 |

### 6. é”™é¢˜æœ¬
| åŠŸèƒ½ | è¯´æ˜ | ä¼˜å…ˆçº§ |
|------|------|--------|
| è‡ªåŠ¨æ”¶é›† | ç­”é”™é¢˜ç›®è‡ªåŠ¨åŠ å…¥é”™é¢˜æœ¬ | P0 |
| é”™é¢˜ç»ƒä¹  | é’ˆå¯¹é”™é¢˜é‡æ–°ç»ƒä¹  | P0 |
| æŒæ¡åº¦è·Ÿè¸ª | è®°å½•é‡å¤ç»ƒä¹ æƒ…å†µ | P1 |

---

## ç³»ç»Ÿæ¶æ„è®¾è®¡

### æŠ€æœ¯æ ˆ
```
å‰ç«¯: Nuxt 3 + Vue 3 + TypeScript + TailwindCSS
åç«¯: Nuxt Server API (Nitro)
æ•°æ®åº“: SQLite (å¼€å‘) / PostgreSQL (ç”Ÿäº§)
ORM: Prisma
è®¤è¯: JWT + bcrypt
çŠ¶æ€ç®¡ç†: Pinia
```

### æ¶æ„å±‚æ¬¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯å±‚ (Nuxt 3 Pages)             â”‚
â”‚  - ç”¨æˆ·ç•Œé¢                                  â”‚
â”‚  - ç®¡ç†å‘˜ç•Œé¢                                â”‚
â”‚  - å…¬å…±ç»„ä»¶åº“                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ä¸­é—´ä»¶å±‚ (Middleware)               â”‚
â”‚  - èº«ä»½éªŒè¯ä¸­é—´ä»¶                            â”‚
â”‚  - æƒé™æ£€æŸ¥ä¸­é—´ä»¶                            â”‚
â”‚  - æ—¥å¿—è®°å½•ä¸­é—´ä»¶                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         APIå±‚ (Server API Routes)           â”‚
â”‚  - è®¤è¯API (/api/auth/*)                    â”‚
â”‚  - ç”¨æˆ·API (/api/user/*)                    â”‚
â”‚  - é¢˜åº“API (/api/questions/*)               â”‚
â”‚  - è€ƒè¯•API (/api/exams/*)                   â”‚
â”‚  - ç®¡ç†API (/api/admin/*)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ä¸šåŠ¡é€»è¾‘å±‚ (Services)                â”‚
â”‚  - AuthService (è®¤è¯æœåŠ¡)                   â”‚
â”‚  - UserService (ç”¨æˆ·æœåŠ¡)                   â”‚
â”‚  - QuestionService (é¢˜ç›®æœåŠ¡)               â”‚
â”‚  - ExamService (è€ƒè¯•æœåŠ¡)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         æ•°æ®è®¿é—®å±‚ (Prisma ORM)              â”‚
â”‚  - User Model                               â”‚
â”‚  - Question Model                           â”‚
â”‚  - Exam Model                               â”‚
â”‚  - StudyPlan Model                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æ•°æ®åº“å±‚                        â”‚
â”‚  SQLite / PostgreSQL                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®åº“è®¾è®¡

### æ ¸å¿ƒè¡¨ç»“æ„å˜æ›´

#### 1. User è¡¨ï¼ˆç”¨æˆ·è¡¨ï¼‰å¢å¼º

```prisma
model User {
  id                String          @id @default(cuid())
  email             String          @unique
  password          String          // bcrypt åŠ å¯†
  name              String
  nickname          String?         // æ˜µç§°
  avatar            String?         // å¤´åƒURL
  role              String          @default("user") // user | admin
  emailVerified     Boolean         @default(false)
  emailVerifyToken  String?
  resetPasswordToken String?
  resetPasswordExpires DateTime?

  // è®¢é˜…çš„è€ƒè¯•ç±»å‹
  subscribedExams   UserExamSubscription[]

  // ç”¨æˆ·çŠ¶æ€
  status            String          @default("active") // active | suspended | deleted
  lastLoginAt       DateTime?
  loginCount        Int             @default(0)

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  // å…³è”æ•°æ®
  userAnswers       UserAnswer[]
  studyPlans        StudyPlan[]
  exams             Exam[]
  wrongQuestions    WrongQuestion[]
  studySessions     StudySession[]
}
```

#### 2. UserExamSubscription è¡¨ï¼ˆç”¨æˆ·è€ƒè¯•è®¢é˜…ï¼‰

```prisma
model UserExamSubscription {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  examType    String   // cale | nccaom
  isActive    Boolean  @default(true)
  subscribedAt DateTime @default(now())
  expiresAt   DateTime? // è®¢é˜…è¿‡æœŸæ—¶é—´ï¼ˆå¦‚æœæ˜¯ä»˜è´¹è®¢é˜…ï¼‰

  @@unique([userId, examType])
  @@index([userId])
  @@index([examType])
}
```

#### 3. Question è¡¨ï¼ˆé¢˜ç›®è¡¨ï¼‰ä¿æŒç°æœ‰ç»“æ„
- æ‰€æœ‰é¢˜ç›®ç”±ç®¡ç†å‘˜ç»Ÿä¸€ç®¡ç†
- é€šè¿‡ `examType` å­—æ®µåŒºåˆ†ä¸åŒè€ƒè¯•
- é€šè¿‡ `categoryId` å…³è”åˆ°å…·ä½“é¢†åŸŸ

#### 4. StudyPlan è¡¨ï¼ˆå­¦ä¹ è®¡åˆ’ï¼‰å·²æœ‰ userId
- ä¿æŒç°æœ‰ç»“æ„
- ç¡®ä¿æ‰€æœ‰æŸ¥è¯¢éƒ½åŸºäº `userId` è¿‡æ»¤

#### 5. Exam è¡¨ï¼ˆè€ƒè¯•è®°å½•ï¼‰å·²æœ‰ userId
- ä¿æŒç°æœ‰ç»“æ„
- ç¡®ä¿æ‰€æœ‰æŸ¥è¯¢éƒ½åŸºäº `userId` è¿‡æ»¤

### æ–°å¢è¡¨

#### 6. AdminLog è¡¨ï¼ˆç®¡ç†å‘˜æ“ä½œæ—¥å¿—ï¼‰

```prisma
model AdminLog {
  id          String   @id @default(cuid())
  adminId     String   // ç®¡ç†å‘˜ç”¨æˆ·ID
  action      String   // æ“ä½œç±»å‹: create_question, update_question, delete_question, etc.
  targetType  String   // æ“ä½œå¯¹è±¡ç±»å‹: question, user, category, etc.
  targetId    String?  // æ“ä½œå¯¹è±¡ID
  details     String?  // æ“ä½œè¯¦æƒ… JSON
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())

  @@index([adminId])
  @@index([action])
  @@index([createdAt])
}
```

#### 7. SystemSettings è¡¨ï¼ˆç³»ç»Ÿè®¾ç½®ï¼‰

```prisma
model SystemSettings {
  id          String   @id @default(cuid())
  key         String   @unique
  value       String   // JSON æ ¼å¼
  description String?
  category    String   // auth, exam, notification, etc.
  updatedAt   DateTime @updatedAt
  updatedBy   String?  // æ›´æ–°è€…ç”¨æˆ·ID
}
```

---

## è®¤è¯ä¸æˆæƒç³»ç»Ÿ

### JWT Token è®¾è®¡

#### Access Token (çŸ­æœŸä»¤ç‰Œ)
```typescript
{
  userId: string
  email: string
  role: string        // user | admin
  subscribedExams: string[] // ['cale', 'nccaom']
  exp: number         // è¿‡æœŸæ—¶é—´: 2å°æ—¶
}
```

#### Refresh Token (é•¿æœŸä»¤ç‰Œ)
```typescript
{
  userId: string
  tokenVersion: number  // ç”¨äºæ’¤é”€æ‰€æœ‰token
  exp: number          // è¿‡æœŸæ—¶é—´: 7å¤©
}
```

### è®¤è¯æµç¨‹

#### 1. ç”¨æˆ·æ³¨å†Œæµç¨‹
```
ç”¨æˆ·å¡«å†™è¡¨å•
    â†“
éªŒè¯é‚®ç®±æ ¼å¼ã€å¯†ç å¼ºåº¦
    â†“
æ£€æŸ¥é‚®ç®±æ˜¯å¦å·²å­˜åœ¨
    â†“
bcrypt åŠ å¯†å¯†ç 
    â†“
åˆ›å»ºç”¨æˆ·è®°å½•ï¼ˆemailVerified=falseï¼‰
    â†“
å‘é€éªŒè¯é‚®ä»¶
    â†“
è¿”å›æ³¨å†ŒæˆåŠŸï¼ˆæç¤ºéªŒè¯é‚®ç®±ï¼‰
```

#### 2. é‚®ç®±éªŒè¯æµç¨‹
```
ç”¨æˆ·ç‚¹å‡»é‚®ä»¶é“¾æ¥
    â†“
éªŒè¯ token æœ‰æ•ˆæ€§
    â†“
æ›´æ–° emailVerified=true
    â†“
è‡ªåŠ¨ç™»å½•ï¼ˆç”ŸæˆJWTï¼‰
```

#### 3. ç”¨æˆ·ç™»å½•æµç¨‹
```
ç”¨æˆ·è¾“å…¥é‚®ç®±å¯†ç 
    â†“
æŸ¥æ‰¾ç”¨æˆ·è®°å½•
    â†“
bcrypt éªŒè¯å¯†ç 
    â†“
æ£€æŸ¥ emailVerified
    â†“
æ£€æŸ¥ç”¨æˆ·çŠ¶æ€ï¼ˆæ˜¯å¦åœç”¨ï¼‰
    â†“
ç”Ÿæˆ Access Token + Refresh Token
    â†“
æ›´æ–° lastLoginAtã€loginCount
    â†“
è¿”å› tokens + ç”¨æˆ·ä¿¡æ¯
```

#### 4. Token åˆ·æ–°æµç¨‹
```
Access Token å³å°†è¿‡æœŸ
    â†“
å‰ç«¯ä½¿ç”¨ Refresh Token è¯·æ±‚åˆ·æ–°
    â†“
éªŒè¯ Refresh Token
    â†“
æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
    â†“
ç”Ÿæˆæ–°çš„ Access Token
    â†“
è¿”å›æ–° token
```

---

## ç”¨æˆ·è§’è‰²ä¸æƒé™

### è§’è‰²å®šä¹‰

| è§’è‰² | æƒé™èŒƒå›´ | è¯´æ˜ |
|------|----------|------|
| **admin** | å…¨éƒ¨ç³»ç»Ÿç®¡ç†æƒé™ | ç®¡ç†é¢˜åº“ã€ç”¨æˆ·ã€ç³»ç»Ÿè®¾ç½® |
| **user** | ä¸ªäººå­¦ä¹ æ•°æ®æƒé™ | å­¦ä¹ è®¡åˆ’ã€è€ƒè¯•è®°å½•ã€é”™é¢˜æœ¬ |

### æƒé™çŸ©é˜µ

| åŠŸèƒ½æ¨¡å— | Admin | User |
|---------|-------|------|
| æŸ¥çœ‹é¢˜åº“ | âœ… | âœ… |
| åˆ›å»º/ç¼–è¾‘/åˆ é™¤é¢˜ç›® | âœ… | âŒ |
| æ‰¹é‡å¯¼å…¥é¢˜ç›® | âœ… | âŒ |
| æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·æ•°æ® | âœ… | âŒ |
| ç®¡ç†ç”¨æˆ·çŠ¶æ€ | âœ… | âŒ |
| åˆ›å»ºå­¦ä¹ è®¡åˆ’ | âœ… | âœ…ï¼ˆä»…è‡ªå·±ï¼‰ |
| åˆ›å»ºæ¨¡æ‹Ÿè€ƒè¯• | âœ… | âœ…ï¼ˆä»…è‡ªå·±ï¼‰ |
| æŸ¥çœ‹è€ƒè¯•è®°å½• | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆä»…è‡ªå·±ï¼‰ |
| åˆ é™¤é¢˜ç›®é›† | âœ…ï¼ˆæ‰€æœ‰ï¼‰ | âœ…ï¼ˆä»…è‡ªå·±ï¼‰ |
| ä¿®æ”¹ç³»ç»Ÿè®¾ç½® | âœ… | âŒ |

---

## æ•°æ®éš”ç¦»ç­–ç•¥

### 1. æ•°æ®åº“å±‚éš”ç¦»

#### Row-Level Security (è¡Œçº§å®‰å…¨)
æ‰€æœ‰æ¶‰åŠç”¨æˆ·æ•°æ®çš„æŸ¥è¯¢ï¼Œå¿…é¡»åŒ…å« `userId` è¿‡æ»¤ï¼š

```typescript
// âœ… æ­£ç¡® - åŸºäº userId è¿‡æ»¤
const studyPlans = await prisma.studyPlan.findMany({
  where: {
    userId: currentUser.id,
    examType: 'cale'
  }
})

// âŒ é”™è¯¯ - æ²¡æœ‰ userId è¿‡æ»¤ï¼Œå¯èƒ½æ³„éœ²å…¶ä»–ç”¨æˆ·æ•°æ®
const studyPlans = await prisma.studyPlan.findMany({
  where: {
    examType: 'cale'
  }
})
```

### 2. API å±‚éš”ç¦»

#### ä¸­é—´ä»¶éªŒè¯
æ¯ä¸ªéœ€è¦è®¤è¯çš„ API éƒ½é€šè¿‡ä¸­é—´ä»¶æå–å¹¶éªŒè¯ç”¨æˆ·èº«ä»½ï¼š

```typescript
// server/middleware/auth.ts
export default defineEventHandler(async (event) => {
  const token = getHeader(event, 'authorization')?.replace('Bearer ', '')

  if (!token) {
    throw createError({ statusCode: 401, message: 'æœªç™»å½•' })
  }

  const decoded = verifyJWT(token)
  event.context.user = decoded  // æ³¨å…¥ç”¨æˆ·ä¿¡æ¯
})
```

#### API å®ç°ç¤ºä¾‹
```typescript
// server/api/study-plans/list.get.ts
export default defineEventHandler(async (event) => {
  const user = event.context.user  // ä»ä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·

  if (!user) {
    throw createError({ statusCode: 401, message: 'æœªç™»å½•' })
  }

  // è‡ªåŠ¨åŸºäº userId è¿‡æ»¤
  const studyPlans = await prisma.studyPlan.findMany({
    where: {
      userId: user.userId,  // åªè¿”å›å½“å‰ç”¨æˆ·çš„æ•°æ®
      examType: getQuery(event).examType
    }
  })

  return { studyPlans }
})
```

### 3. å‰ç«¯å±‚éš”ç¦»

#### çŠ¶æ€ç®¡ç†
```typescript
// stores/auth.ts
export const useAuthStore = defineStore('auth', {
  state: () => ({
    user: null,
    token: null,
    subscribedExams: []
  }),

  getters: {
    isAuthenticated: (state) => !!state.token,
    isAdmin: (state) => state.user?.role === 'admin',
    canAccessExam: (state) => (examType: string) => {
      return state.subscribedExams.includes(examType)
    }
  }
})
```

#### è·¯ç”±å®ˆå«
```typescript
// middleware/auth.global.ts
export default defineNuxtRouteMiddleware((to, from) => {
  const authStore = useAuthStore()

  // éœ€è¦ç™»å½•çš„é¡µé¢
  if (to.path.startsWith('/exam') || to.path.startsWith('/study-plan')) {
    if (!authStore.isAuthenticated) {
      return navigateTo('/login')
    }
  }

  // ç®¡ç†å‘˜é¡µé¢
  if (to.path.startsWith('/admin')) {
    if (!authStore.isAdmin) {
      return navigateTo('/')
    }
  }

  // è€ƒè¯•ç±»å‹è®¢é˜…æ£€æŸ¥
  const examType = to.query.examType || to.params.examType
  if (examType && !authStore.canAccessExam(examType)) {
    return navigateTo('/subscribe')
  }
})
```

---

## APIè®¾è®¡

### è®¤è¯ç›¸å…³ API

#### POST /api/auth/register
æ³¨å†Œæ–°ç”¨æˆ·

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!",
  "name": "å¼ ä¸‰"
}
```

**å“åº”:**
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·æŸ¥æ”¶éªŒè¯é‚®ä»¶",
  "userId": "cuid..."
}
```

#### POST /api/auth/login
ç”¨æˆ·ç™»å½•

**è¯·æ±‚ä½“:**
```json
{
  "email": "user@example.com",
  "password": "SecurePass123!"
}
```

**å“åº”:**
```json
{
  "success": true,
  "accessToken": "eyJhbGc...",
  "refreshToken": "eyJhbGc...",
  "user": {
    "id": "cuid...",
    "email": "user@example.com",
    "name": "å¼ ä¸‰",
    "role": "user",
    "subscribedExams": ["cale"]
  }
}
```

#### POST /api/auth/refresh
åˆ·æ–° Token

**è¯·æ±‚ä½“:**
```json
{
  "refreshToken": "eyJhbGc..."
}
```

**å“åº”:**
```json
{
  "success": true,
  "accessToken": "eyJhbGc..."
}
```

#### POST /api/auth/logout
ç™»å‡º

**è¯·æ±‚å¤´:**
```
Authorization: Bearer <token>
```

**å“åº”:**
```json
{
  "success": true,
  "message": "ç™»å‡ºæˆåŠŸ"
}
```

#### GET /api/auth/verify-email?token=xxx
éªŒè¯é‚®ç®±

**å“åº”:**
```json
{
  "success": true,
  "message": "é‚®ç®±éªŒè¯æˆåŠŸ",
  "accessToken": "eyJhbGc...",
  "refreshToken": "eyJhbGc..."
}
```

---

### ç”¨æˆ·ç›¸å…³ API

#### GET /api/user/profile
è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**è¯·æ±‚å¤´:**
```
Authorization: Bearer <token>
```

**å“åº”:**
```json
{
  "user": {
    "id": "cuid...",
    "email": "user@example.com",
    "name": "å¼ ä¸‰",
    "nickname": "å°å¼ ",
    "avatar": "https://...",
    "role": "user",
    "subscribedExams": [
      {
        "examType": "cale",
        "isActive": true,
        "subscribedAt": "2025-10-20T..."
      }
    ],
    "createdAt": "2025-10-01T...",
    "lastLoginAt": "2025-10-20T..."
  }
}
```

#### PUT /api/user/profile
æ›´æ–°ç”¨æˆ·ä¿¡æ¯

**è¯·æ±‚ä½“:**
```json
{
  "name": "å¼ ä¸‰",
  "nickname": "å°å¼ ",
  "avatar": "https://..."
}
```

#### POST /api/user/change-password
ä¿®æ”¹å¯†ç 

**è¯·æ±‚ä½“:**
```json
{
  "oldPassword": "OldPass123!",
  "newPassword": "NewPass123!"
}
```

#### POST /api/user/subscribe-exam
è®¢é˜…è€ƒè¯•ç±»å‹

**è¯·æ±‚ä½“:**
```json
{
  "examType": "nccaom"
}
```

**å“åº”:**
```json
{
  "success": true,
  "message": "è®¢é˜…æˆåŠŸ",
  "subscription": {
    "examType": "nccaom",
    "subscribedAt": "2025-10-20T..."
  }
}
```

---

### é¢˜åº“ç›¸å…³ APIï¼ˆéœ€è¦è®¤è¯ï¼‰

#### GET /api/questions/list
è·å–é¢˜ç›®åˆ—è¡¨ï¼ˆå¸¦åˆ†é¡µï¼‰

**æŸ¥è¯¢å‚æ•°:**
```
?examType=cale&categoryId=xxx&difficulty=medium&page=1&pageSize=20
```

**å“åº”:**
```json
{
  "questions": [...],
  "total": 596,
  "page": 1,
  "pageSize": 20,
  "totalPages": 30
}
```

#### GET /api/questions/:id
è·å–é¢˜ç›®è¯¦æƒ…

**å“åº”:**
```json
{
  "question": {
    "id": "cuid...",
    "examType": "cale",
    "type": "multiple_choice",
    "question": "é¢˜ç›®å†…å®¹...",
    "options": ["A. é€‰é¡¹1", "B. é€‰é¡¹2", ...],
    "correctAnswer": "A",
    "explanation": "è§£æ...",
    "difficulty": "medium",
    "category": {
      "name": "è¯„ä¼°ä¸è¯Šæ–­",
      "code": "DOMAIN_1_ASSESSMENT"
    }
  }
}
```

---

### å­¦ä¹ è®¡åˆ’ APIï¼ˆéœ€è¦è®¤è¯ + userId éš”ç¦»ï¼‰

#### GET /api/study-plans/list
è·å–å½“å‰ç”¨æˆ·çš„å­¦ä¹ è®¡åˆ’åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°:**
```
?examType=cale
```

**å“åº”:**
```json
{
  "studyPlans": [
    {
      "id": "cuid...",
      "name": "30å¤©å†²åˆºè®¡åˆ’",
      "examType": "cale",
      "startDate": "2025-10-20",
      "endDate": "2025-11-20",
      "isActive": true,
      "progress": 35,
      "totalItems": 200,
      "completedItems": 70
    }
  ]
}
```

#### POST /api/study-plans/create
åˆ›å»ºå­¦ä¹ è®¡åˆ’

**è¯·æ±‚ä½“:**
```json
{
  "name": "30å¤©å†²åˆºè®¡åˆ’",
  "examType": "cale",
  "startDate": "2025-10-20",
  "endDate": "2025-11-20",
  "questionIds": ["q1", "q2", "q3", ...]
}
```

---

### è€ƒè¯•ç›¸å…³ APIï¼ˆéœ€è¦è®¤è¯ + userId éš”ç¦»ï¼‰

#### GET /api/exams/list
è·å–å½“å‰ç”¨æˆ·çš„è€ƒè¯•åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°:**
```
?examType=cale&mode=mock
```

#### POST /api/exams/create
åˆ›å»ºè€ƒè¯•ï¼ˆä¿æŒç°æœ‰æ¥å£ï¼‰

#### POST /api/exams/create-mock
ä¸€é”®ç”Ÿæˆå…¨çœŸæ¨¡æ‹Ÿè€ƒè¯•ï¼ˆä¿æŒç°æœ‰æ¥å£ï¼‰

#### DELETE /api/exams/delete
åˆ é™¤è€ƒè¯•ï¼ˆæ·»åŠ  userId éªŒè¯ï¼‰

**è¯·æ±‚ä½“:**
```json
{
  "examIds": ["exam1", "exam2"]
}
```

**æƒé™æ£€æŸ¥:**
```typescript
// ç¡®ä¿ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„è€ƒè¯•
const exams = await prisma.exam.findMany({
  where: {
    id: { in: examIds },
    userId: currentUser.userId  // å…³é”®ï¼šéªŒè¯æ‰€æœ‰æƒ
  }
})

if (exams.length !== examIds.length) {
  throw createError({ statusCode: 403, message: 'æ— æƒåˆ é™¤ä»–äººçš„è€ƒè¯•' })
}
```

---

### ç®¡ç†å‘˜ APIï¼ˆéœ€è¦ admin è§’è‰²ï¼‰

#### POST /api/admin/login
ç®¡ç†å‘˜ç™»å½•

**è¯·æ±‚ä½“:**
```json
{
  "email": "admin@example.com",
  "password": "AdminPass123!"
}
```

#### GET /api/admin/users
è·å–ç”¨æˆ·åˆ—è¡¨

**æŸ¥è¯¢å‚æ•°:**
```
?page=1&pageSize=20&status=active&search=å¼ ä¸‰
```

**å“åº”:**
```json
{
  "users": [
    {
      "id": "cuid...",
      "email": "user@example.com",
      "name": "å¼ ä¸‰",
      "role": "user",
      "status": "active",
      "subscribedExams": ["cale"],
      "loginCount": 25,
      "lastLoginAt": "2025-10-20T...",
      "createdAt": "2025-10-01T..."
    }
  ],
  "total": 150,
  "page": 1,
  "pageSize": 20
}
```

#### PUT /api/admin/users/:id/status
æ›´æ–°ç”¨æˆ·çŠ¶æ€

**è¯·æ±‚ä½“:**
```json
{
  "status": "suspended"  // active | suspended
}
```

#### POST /api/admin/questions/create
åˆ›å»ºé¢˜ç›®ï¼ˆä¿æŒç°æœ‰æ¥å£ï¼Œæ·»åŠ æ—¥å¿—ï¼‰

#### POST /api/admin/questions/batch-import
æ‰¹é‡å¯¼å…¥é¢˜ç›®

**è¯·æ±‚ä½“:**
```json
{
  "examType": "cale",
  "questions": [
    {
      "question": "é¢˜ç›®å†…å®¹...",
      "options": ["A. é€‰é¡¹1", "B. é€‰é¡¹2"],
      "correctAnswer": "A",
      "explanation": "è§£æ...",
      "difficulty": "medium",
      "categoryCode": "DOMAIN_1_ASSESSMENT"
    }
  ]
}
```

#### GET /api/admin/stats
ç³»ç»Ÿç»Ÿè®¡æ•°æ®

**å“åº”:**
```json
{
  "stats": {
    "totalUsers": 150,
    "activeUsers": 120,
    "totalQuestions": {
      "cale": 596,
      "nccaom": 0
    },
    "totalExams": 1250,
    "totalStudyPlans": 350
  }
}
```

---

## å‰ç«¯é¡µé¢æµç¨‹

### 1. è®¤è¯æµç¨‹é¡µé¢

#### é¡µé¢è·¯ç”±è®¾è®¡
```
/login              - ç™»å½•é¡µ
/register           - æ³¨å†Œé¡µ
/verify-email       - é‚®ç®±éªŒè¯é¡µ
/forgot-password    - å¿˜è®°å¯†ç é¡µ
/reset-password     - é‡ç½®å¯†ç é¡µ
```

#### ç™»å½•é¡µ (/login)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CALE/NCCAOM å­¦ä¹ å¹³å°        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é‚®ç®±: [________________]            â”‚
â”‚  å¯†ç : [________________]            â”‚
â”‚                                     â”‚
â”‚  [è®°ä½æˆ‘] [å¿˜è®°å¯†ç ?]                â”‚
â”‚                                     â”‚
â”‚  [ ç™» å½• ]                          â”‚
â”‚                                     â”‚
â”‚  è¿˜æ²¡æœ‰è´¦å·ï¼Ÿ[ç«‹å³æ³¨å†Œ]              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ³¨å†Œé¡µ (/register)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            åˆ›å»ºæ–°è´¦å·                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å§“å: [________________]            â”‚
â”‚  é‚®ç®±: [________________]            â”‚
â”‚  å¯†ç : [________________]            â”‚
â”‚  ç¡®è®¤å¯†ç : [________________]        â”‚
â”‚                                     â”‚
â”‚  é€‰æ‹©è€ƒè¯•ç±»å‹:                       â”‚
â”‚  â–¡ CALE (åŠ å·é’ˆç¸æ‰§ç…§è€ƒè¯•)           â”‚
â”‚  â–¡ NCCAOM (å…¨å›½ä¸­åŒ»è®¤è¯è€ƒè¯•)         â”‚
â”‚                                     â”‚
â”‚  [ æ³¨ å†Œ ]                          â”‚
â”‚                                     â”‚
â”‚  å·²æœ‰è´¦å·ï¼Ÿ[ç«‹å³ç™»å½•]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ä¸»é¡µé¢æµç¨‹

#### ç™»å½•åé¦–é¡µ (/)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo] CALE/NCCAOM å­¦ä¹ å¹³å°    [å¼ ä¸‰] [é€€å‡º]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  æ¬¢è¿å›æ¥ï¼Œå¼ ä¸‰ï¼                                â”‚
â”‚                                                 â”‚
â”‚  é€‰æ‹©æ‚¨è¦å­¦ä¹ çš„è€ƒè¯•ç±»å‹ï¼š                         â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   CALE è€ƒè¯•  â”‚  â”‚  NCCAOM è€ƒè¯• â”‚            â”‚
â”‚  â”‚  åŠ å·é’ˆç¸æ‰§ç…§ â”‚  â”‚  å…¨å›½ä¸­åŒ»è®¤è¯ â”‚            â”‚
â”‚  â”‚              â”‚  â”‚              â”‚            â”‚
â”‚  â”‚ [è¿›å…¥å­¦ä¹ ]   â”‚  â”‚ [è®¢é˜…è§£é”]   â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                 â”‚
â”‚  æˆ‘çš„å­¦ä¹ æ•°æ®:                                   â”‚
â”‚  - å­¦ä¹ å¤©æ•°: 25å¤©                                â”‚
â”‚  - å®Œæˆé¢˜ç›®: 350/596                            â”‚
â”‚  - æ¨¡æ‹Ÿè€ƒè¯•: 5æ¬¡                                 â”‚
â”‚  - å¹³å‡åˆ†æ•°: 78%                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é€‰æ‹©è€ƒè¯•å - è€ƒè¯•ä¸»é¡µ (/exam?type=cale)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è¿”å›é¦–é¡µ] CALE è€ƒè¯•   [å­¦ä¹ è®¡åˆ’] [é¢˜åº“] [ä¸ªäºº]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ğŸ“š å­¦ä¹ è®¡åˆ’                      â”‚          â”‚
â”‚  â”‚  åˆ›å»ºä¸ªæ€§åŒ–å­¦ä¹ è®¡åˆ’ï¼Œç³»ç»Ÿè·Ÿè¸ªè¿›åº¦  â”‚          â”‚
â”‚  â”‚  [åˆ›å»ºå­¦ä¹ è®¡åˆ’] [æŸ¥çœ‹æˆ‘çš„è®¡åˆ’]     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  âš¡ ä¸€é”®ç”Ÿæˆå…¨çœŸæ¨¡æ‹Ÿè€ƒè¯•           â”‚          â”‚
â”‚  â”‚  200é¢˜ Â· 300åˆ†é’Ÿ Â· æŒ‰å®˜æ–¹æ¯”ä¾‹åˆ†é…  â”‚          â”‚
â”‚  â”‚  [ç«‹å³ç”Ÿæˆ]                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  âœï¸ è‡ªå®šä¹‰æ¨¡æ‹Ÿè€ƒè¯•                 â”‚          â”‚
â”‚  â”‚  è‡ªç”±é€‰æ‹©é¢˜ç›®æ•°é‡ã€éš¾åº¦ã€é¢†åŸŸ       â”‚          â”‚
â”‚  â”‚  [æ‰‹åŠ¨é…ç½®]                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  ğŸ“ æˆ‘çš„é¢˜ç›®é›†                     â”‚          â”‚
â”‚  â”‚  æŸ¥çœ‹å·²ç”Ÿæˆçš„å­¦ä¹ é¢˜ç›®å’Œè€ƒè¯•è®°å½•     â”‚          â”‚
â”‚  â”‚  [æŸ¥çœ‹åˆ—è¡¨]                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  âŒ é”™é¢˜æœ¬                         â”‚          â”‚
â”‚  â”‚  é’ˆå¯¹æ€§å¤ä¹ ç­”é”™çš„é¢˜ç›®               â”‚          â”‚
â”‚  â”‚  [æŸ¥çœ‹é”™é¢˜]                        â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. ç®¡ç†å‘˜é¡µé¢æµç¨‹

#### ç®¡ç†å‘˜ç™»å½• (/admin/login)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç®¡ç†å‘˜ç™»å½•                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é‚®ç®±: [________________]            â”‚
â”‚  å¯†ç : [________________]            â”‚
â”‚                                     â”‚
â”‚  [ ç™» å½• ]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç®¡ç†å‘˜æ§åˆ¶å° (/admin/dashboard)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [Logo] ç®¡ç†å‘˜æ§åˆ¶å°        [ç®¡ç†å‘˜] [é€€å‡º]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ä»ªè¡¨ç›˜] [é¢˜åº“ç®¡ç†] [ç”¨æˆ·ç®¡ç†] [ç³»ç»Ÿè®¾ç½®]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                 â”‚
â”‚  ç³»ç»Ÿæ¦‚è§ˆ                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ ç”¨æˆ·æ€»æ•° â”‚ â”‚ é¢˜ç›®æ€»æ•° â”‚ â”‚ æ´»è·ƒç”¨æˆ· â”‚          â”‚
â”‚  â”‚  150    â”‚ â”‚  596    â”‚ â”‚  120    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                 â”‚
â”‚  æœ€è¿‘ç”¨æˆ·æ´»åŠ¨                                    â”‚
â”‚  - å¼ ä¸‰ å®Œæˆäº† CALE æ¨¡æ‹Ÿè€ƒè¯• (30åˆ†é’Ÿå‰)          â”‚
â”‚  - æå›› åˆ›å»ºäº†æ–°çš„å­¦ä¹ è®¡åˆ’ (1å°æ—¶å‰)             â”‚
â”‚  - ç‹äº” æ³¨å†Œäº†æ–°è´¦å· (2å°æ—¶å‰)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### é¢˜åº“ç®¡ç†é¡µ (/admin/questions)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é¢˜åº“ç®¡ç†                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è€ƒè¯•ç±»å‹: [CALE â–¼]  é¢†åŸŸ: [å…¨éƒ¨ â–¼]              â”‚
â”‚ æœç´¢: [___________]  [+ æ–°å»ºé¢˜ç›®] [æ‰¹é‡å¯¼å…¥]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¡ | ID | é¢˜ç›®å†…å®¹ | é¢†åŸŸ | éš¾åº¦ | æ“ä½œ           â”‚
â”‚ â–¡ | 1  | æ ¹æ®ä¸­åŒ»... | D1 | ä¸­ç­‰ | [ç¼–è¾‘][åˆ é™¤] â”‚
â”‚ â–¡ | 2  | æ‚£è€…å‡ºç°... | D2 | å›°éš¾ | [ç¼–è¾‘][åˆ é™¤] â”‚
â”‚ ...                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å·²é€‰æ‹© 0 é¡¹  [æ‰¹é‡åˆ é™¤]       ç¬¬1é¡µ/å…±30é¡µ >    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ç”¨æˆ·ç®¡ç†é¡µ (/admin/users)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç®¡ç†                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æœç´¢: [___________]  çŠ¶æ€: [å…¨éƒ¨ â–¼]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ID | å§“å | é‚®ç®± | è®¢é˜…è€ƒè¯• | çŠ¶æ€ | æ“ä½œ        â”‚
â”‚ 1  | å¼ ä¸‰ | z@..| CALE    | æ´»è·ƒ | [åœç”¨][ç¼–è¾‘]â”‚
â”‚ 2  | æå›› | l@..| CALE,NC | æ´»è·ƒ | [åœç”¨][ç¼–è¾‘]â”‚
â”‚ ...                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         ç¬¬1é¡µ/å…±8é¡µ >           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å®æ–½è·¯çº¿å›¾

### Phase 1: åŸºç¡€è®¤è¯ç³»ç»Ÿ (Week 1-2)

#### 1.1 æ•°æ®åº“è¿ç§»
- [x] å¢å¼º User è¡¨ç»“æ„
- [ ] åˆ›å»º UserExamSubscription è¡¨
- [ ] åˆ›å»º AdminLog è¡¨
- [ ] åˆ›å»º SystemSettings è¡¨
- [ ] è¿è¡Œ Prisma è¿ç§»

#### 1.2 åç«¯è®¤è¯ API
- [ ] å®ç° JWT å·¥å…·å‡½æ•° (sign, verify, refresh)
- [ ] å®ç° bcrypt å¯†ç åŠ å¯†å·¥å…·
- [ ] åˆ›å»º /api/auth/register
- [ ] åˆ›å»º /api/auth/login
- [ ] åˆ›å»º /api/auth/refresh
- [ ] åˆ›å»º /api/auth/logout
- [ ] åˆ›å»ºè®¤è¯ä¸­é—´ä»¶ (server/middleware/auth.ts)

#### 1.3 å‰ç«¯è®¤è¯é¡µé¢
- [ ] åˆ›å»º Pinia auth store
- [ ] åˆ›å»ºç™»å½•é¡µ (/login)
- [ ] åˆ›å»ºæ³¨å†Œé¡µ (/register)
- [ ] åˆ›å»ºå…¨å±€è·¯ç”±å®ˆå« (middleware/auth.global.ts)
- [ ] å®ç° Token è‡ªåŠ¨åˆ·æ–°æœºåˆ¶

**æµ‹è¯•æ£€æŸ¥ç‚¹:**
- [x] ç”¨æˆ·å¯ä»¥æ³¨å†Œæ–°è´¦å·
- [ ] ç”¨æˆ·å¯ä»¥ç™»å½•å¹¶è·å¾— JWT token
- [ ] Token è¿‡æœŸåè‡ªåŠ¨åˆ·æ–°
- [ ] æœªç™»å½•ç”¨æˆ·è®¿é—®å—ä¿æŠ¤é¡µé¢ä¼šè·³è½¬åˆ°ç™»å½•é¡µ

---

### Phase 2: ç”¨æˆ·ç³»ç»Ÿä¸æƒé™ (Week 3)

#### 2.1 ç”¨æˆ·ä¸ªäººä¸­å¿ƒ
- [ ] åˆ›å»º /api/user/profile (GET/PUT)
- [ ] åˆ›å»º /api/user/change-password
- [ ] åˆ›å»º /api/user/subscribe-exam
- [ ] åˆ›å»ºä¸ªäººä¿¡æ¯é¡µ (/user/profile)
- [ ] åˆ›å»ºè€ƒè¯•è®¢é˜…é¡µ (/user/subscriptions)

#### 2.2 æƒé™æ§åˆ¶ä¸­é—´ä»¶
- [ ] åˆ›å»º requireAuth ä¸­é—´ä»¶
- [ ] åˆ›å»º requireAdmin ä¸­é—´ä»¶
- [ ] åˆ›å»º requireExamSubscription ä¸­é—´ä»¶

#### 2.3 æ•°æ®éš”ç¦»æ”¹é€ 
- [ ] æ”¹é€ æ‰€æœ‰ StudyPlan APIï¼ˆæ·»åŠ  userId è¿‡æ»¤ï¼‰
- [ ] æ”¹é€ æ‰€æœ‰ Exam APIï¼ˆæ·»åŠ  userId è¿‡æ»¤ï¼‰
- [ ] æ”¹é€ æ‰€æœ‰ UserAnswer APIï¼ˆæ·»åŠ  userId è¿‡æ»¤ï¼‰
- [ ] æ”¹é€ æ‰€æœ‰ WrongQuestion APIï¼ˆæ·»åŠ  userId è¿‡æ»¤ï¼‰

**æµ‹è¯•æ£€æŸ¥ç‚¹:**
- [ ] ç”¨æˆ·åªèƒ½çœ‹åˆ°è‡ªå·±çš„å­¦ä¹ è®¡åˆ’
- [ ] ç”¨æˆ·åªèƒ½åˆ é™¤è‡ªå·±çš„è€ƒè¯•è®°å½•
- [ ] ç”¨æˆ·æ— æ³•è®¿é—®å…¶ä»–ç”¨æˆ·çš„æ•°æ®
- [ ] æœªè®¢é˜…çš„è€ƒè¯•ç±»å‹æ— æ³•è®¿é—®

---

### Phase 3: å¤šè€ƒè¯•ç±»å‹æ”¯æŒ (Week 4)

#### 3.1 é¦–é¡µä¸è€ƒè¯•é€‰æ‹©
- [ ] åˆ›å»ºæ–°çš„é¦–é¡µ (/)ï¼Œå±•ç¤ºå·²è®¢é˜…è€ƒè¯•
- [ ] åˆ›å»ºè€ƒè¯•é€‰æ‹©æµç¨‹
- [ ] æ”¹é€  ExamSelector ç»„ä»¶ï¼ˆåŸºäºç”¨æˆ·è®¢é˜…ï¼‰

#### 3.2 è€ƒè¯•ç±»å‹è·¯ç”±
- [ ] é‡æ„è·¯ç”±ç»“æ„ï¼š
  ```
  /                          - é¦–é¡µï¼ˆé€‰æ‹©è€ƒè¯•ç±»å‹ï¼‰
  /exam/cale                 - CALE è€ƒè¯•ä¸»é¡µ
  /exam/cale/study-plans     - CALE å­¦ä¹ è®¡åˆ’
  /exam/cale/question-sets   - CALE é¢˜ç›®é›†
  /exam/nccaom               - NCCAOM è€ƒè¯•ä¸»é¡µ
  /exam/nccaom/study-plans   - NCCAOM å­¦ä¹ è®¡åˆ’
  ```

#### 3.3 æ•°æ®å±•ç¤ºè¿‡æ»¤
- [ ] æ‰€æœ‰é¡µé¢æ·»åŠ  examType è¿‡æ»¤
- [ ] æ·»åŠ è€ƒè¯•ç±»å‹åˆ‡æ¢ç»„ä»¶

**æµ‹è¯•æ£€æŸ¥ç‚¹:**
- [ ] ç”¨æˆ·å¯ä»¥è®¢é˜…å¤šä¸ªè€ƒè¯•ç±»å‹
- [ ] CALE å’Œ NCCAOM æ•°æ®å®Œå…¨éš”ç¦»
- [ ] åˆ‡æ¢è€ƒè¯•ç±»å‹æ—¶æ•°æ®æ­£ç¡®åˆ‡æ¢

---

### Phase 4: ç®¡ç†å‘˜ç³»ç»Ÿ (Week 5-6)

#### 4.1 ç®¡ç†å‘˜è®¤è¯
- [ ] åˆ›å»º /api/admin/login
- [ ] åˆ›å»ºç®¡ç†å‘˜ç™»å½•é¡µ (/admin/login)
- [ ] åˆ›å»ºç®¡ç†å‘˜è·¯ç”±å®ˆå«

#### 4.2 ç®¡ç†å‘˜æ§åˆ¶å°
- [ ] åˆ›å»ºç®¡ç†å‘˜ä»ªè¡¨ç›˜ (/admin/dashboard)
- [ ] å®ç°ç³»ç»Ÿç»Ÿè®¡ API (/api/admin/stats)
- [ ] åˆ›å»ºç”¨æˆ·ç®¡ç†é¡µ (/admin/users)
- [ ] å®ç°ç”¨æˆ·ç®¡ç† API (list, update status)

#### 4.3 é¢˜åº“ç®¡ç†å¢å¼º
- [ ] æ”¹é€ é¢˜åº“ç®¡ç†é¡µï¼ˆç®¡ç†å‘˜ä¸“å±ï¼‰
- [ ] å®ç°æ‰¹é‡å¯¼å…¥ API (/api/admin/questions/batch-import)
- [ ] å®ç°æ“ä½œæ—¥å¿—è®°å½•

**æµ‹è¯•æ£€æŸ¥ç‚¹:**
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
- [ ] ç®¡ç†å‘˜å¯ä»¥åœç”¨/å¯ç”¨ç”¨æˆ·
- [ ] ç®¡ç†å‘˜å¯ä»¥æ‰¹é‡å¯¼å…¥é¢˜ç›®
- [ ] æ‰€æœ‰ç®¡ç†æ“ä½œéƒ½æœ‰æ—¥å¿—è®°å½•

---

### Phase 5: é‚®ä»¶ä¸é«˜çº§åŠŸèƒ½ (Week 7)

#### 5.1 é‚®ä»¶ç³»ç»Ÿ
- [ ] é›†æˆé‚®ä»¶æœåŠ¡ (nodemailer / SendGrid)
- [ ] å®ç°é‚®ç®±éªŒè¯åŠŸèƒ½
- [ ] å®ç°å¿˜è®°å¯†ç åŠŸèƒ½
- [ ] åˆ›å»ºé‚®ä»¶æ¨¡æ¿

#### 5.2 é«˜çº§åŠŸèƒ½
- [ ] å®ç°é”™é¢˜æœ¬æ™ºèƒ½æ¨è
- [ ] å®ç°å­¦ä¹ è¿›åº¦æ•°æ®å¯è§†åŒ–
- [ ] å®ç°æˆç»©æŠ¥å‘Šè¯¦ç»†åˆ†æ

---

### Phase 6: æµ‹è¯•ä¸ä¼˜åŒ– (Week 8)

#### 6.1 æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰
- [ ] é›†æˆæµ‹è¯•ï¼ˆAPI æµ‹è¯•ï¼‰
- [ ] E2E æµ‹è¯•ï¼ˆå…³é”®ç”¨æˆ·æµç¨‹ï¼‰

#### 6.2 æ€§èƒ½ä¼˜åŒ–
- [ ] æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–ï¼ˆæ·»åŠ ç´¢å¼•ï¼‰
- [ ] API å“åº”ç¼“å­˜
- [ ] å‰ç«¯ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½

#### 6.3 å®‰å…¨åŠ å›º
- [ ] SQL æ³¨å…¥é˜²æŠ¤ï¼ˆPrisma è‡ªåŠ¨å¤„ç†ï¼‰
- [ ] XSS é˜²æŠ¤
- [ ] CSRF é˜²æŠ¤
- [ ] Rate Limitingï¼ˆAPI é™æµï¼‰

---

## æ•°æ®è¿ç§»ç­–ç•¥

### ç°æœ‰æ•°æ®å¤„ç†

#### 1. User è¡¨è¿ç§»
```sql
-- å°†ç°æœ‰ demo-user è½¬æ¢ä¸ºçœŸå®ç”¨æˆ·
UPDATE User
SET
  email = 'demo@example.com',
  password = '<bcrypt_hash>',
  role = 'user',
  emailVerified = true
WHERE id = 'demo-user';

-- æˆ–è€…åˆ›å»ºæ–°çš„æµ‹è¯•ç”¨æˆ·ï¼Œåˆ é™¤ demo-user
INSERT INTO User (...) VALUES (...);
```

#### 2. å…³è”æ•°æ®å¤„ç†
```sql
-- æ‰€æœ‰è€ƒè¯•è®°å½•ã€å­¦ä¹ è®¡åˆ’ç­‰å·²ç»å…³è”äº† userId
-- åªéœ€è¦ç¡®ä¿ userId æŒ‡å‘æœ‰æ•ˆçš„ç”¨æˆ·å³å¯
SELECT COUNT(*) FROM Exam WHERE userId NOT IN (SELECT id FROM User);
SELECT COUNT(*) FROM StudyPlan WHERE userId NOT IN (SELECT id FROM User);
```

#### 3. è®¢é˜…æ•°æ®åˆ›å»º
```sql
-- ä¸ºç°æœ‰ç”¨æˆ·åˆ›å»ºè€ƒè¯•è®¢é˜…è®°å½•
INSERT INTO UserExamSubscription (userId, examType, isActive)
SELECT id, 'cale', true
FROM User
WHERE role = 'user';
```

---

## å®‰å…¨æœ€ä½³å®è·µ

### 1. å¯†ç å®‰å…¨
- âœ… bcrypt åŠ å¯†ï¼Œsalt rounds >= 10
- âœ… å¯†ç å¼ºåº¦è¦æ±‚ï¼šè‡³å°‘8ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯å’Œæ•°å­—
- âœ… ç¦æ­¢å¸¸è§å¼±å¯†ç 

### 2. Token å®‰å…¨
- âœ… Access Token çŸ­æœŸæœ‰æ•ˆï¼ˆ2å°æ—¶ï¼‰
- âœ… Refresh Token é•¿æœŸæœ‰æ•ˆï¼ˆ7å¤©ï¼‰
- âœ… Token å­˜å‚¨åœ¨ httpOnly cookieï¼ˆå¯é€‰ï¼‰
- âœ… å®ç° Token é»‘åå•æœºåˆ¶ï¼ˆç™»å‡ºæ—¶ï¼‰

### 3. API å®‰å…¨
- âœ… æ‰€æœ‰æ•æ„Ÿ API éœ€è¦è®¤è¯
- âœ… å®ç° Rate Limiting é˜²æ­¢æš´åŠ›ç ´è§£
- âœ… è¾“å…¥éªŒè¯å’Œæ¶ˆæ¯’
- âœ… CORS é…ç½®

### 4. æ•°æ®å®‰å…¨
- âœ… ä¸¥æ ¼çš„ userId è¿‡æ»¤ï¼Œé˜²æ­¢è¶Šæƒè®¿é—®
- âœ… æ•æ„Ÿä¿¡æ¯ä¸åœ¨å‰ç«¯æš´éœ²
- âœ… å®šæœŸæ•°æ®åº“å¤‡ä»½

---

## éƒ¨ç½²å»ºè®®

### å¼€å‘ç¯å¢ƒ
```bash
# ä½¿ç”¨ SQLite
DATABASE_URL="file:./dev.db"
JWT_SECRET="dev-secret-key"
JWT_REFRESH_SECRET="dev-refresh-secret-key"
```

### ç”Ÿäº§ç¯å¢ƒ
```bash
# ä½¿ç”¨ PostgreSQL
DATABASE_URL="postgresql://user:password@host:5432/dbname"
JWT_SECRET="<strong-random-secret>"
JWT_REFRESH_SECRET="<strong-random-secret>"
NODE_ENV="production"

# é‚®ä»¶æœåŠ¡
SMTP_HOST="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USER="your-email@gmail.com"
SMTP_PASS="your-app-password"

# ç®¡ç†å‘˜è´¦å·
ADMIN_EMAIL="admin@example.com"
ADMIN_PASSWORD="<strong-password>"
```

---

## æ€»ç»“

è¿™ä¸ªè®¾è®¡æ–¹æ¡ˆæä¾›äº†ï¼š

1. **å®Œæ•´çš„ç”¨æˆ·è®¤è¯ç³»ç»Ÿ** - æ³¨å†Œã€ç™»å½•ã€é‚®ç®±éªŒè¯ã€å¯†ç é‡ç½®
2. **ä¸¥æ ¼çš„æƒé™æ§åˆ¶** - åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰
3. **å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»** - ç”¨æˆ·ä¹‹é—´æ•°æ®å®Œå…¨éš”ç¦»
4. **å¤šè€ƒè¯•ç±»å‹æ”¯æŒ** - CALEã€NCCAOM ç­‰å¤šç§è€ƒè¯•
5. **ç®¡ç†å‘˜ç³»ç»Ÿ** - ç»Ÿä¸€ç®¡ç†é¢˜åº“å’Œç”¨æˆ·
6. **å¯æ‰©å±•æ¶æ„** - æ¸…æ™°çš„åˆ†å±‚æ¶æ„ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•

### æ ¸å¿ƒåŸåˆ™

- ğŸ” **å®‰å…¨ç¬¬ä¸€**: JWT + bcrypt + æ•°æ®éš”ç¦»
- ğŸ‘¥ **ç”¨æˆ·ä½“éªŒ**: ç®€æ´çš„æ³¨å†Œç™»å½•æµç¨‹
- ğŸ¯ **æƒé™æ¸…æ™°**: Admin vs User æ˜ç¡®åˆ†å·¥
- ğŸ“Š **æ•°æ®éš”ç¦»**: æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹æ•°æ®ç©ºé—´
- ğŸ”„ **å¯æ‰©å±•**: æ”¯æŒæ·»åŠ æ›´å¤šè€ƒè¯•ç±»å‹

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

å»ºè®®æŒ‰ç…§å®æ–½è·¯çº¿å›¾çš„é¡ºåºæ‰§è¡Œï¼š

1. **ç«‹å³å¼€å§‹**: Phase 1 - åŸºç¡€è®¤è¯ç³»ç»Ÿ
2. **ä¼˜å…ˆçº§**: ç”¨æˆ·è®¤è¯ > æƒé™æ§åˆ¶ > æ•°æ®éš”ç¦» > ç®¡ç†å‘˜ç³»ç»Ÿ
3. **è¿­ä»£å¼€å‘**: æ¯å®Œæˆä¸€ä¸ª Phase è¿›è¡Œæµ‹è¯•éªŒè¯
4. **æŒç»­ä¼˜åŒ–**: æ ¹æ®å®é™…ä½¿ç”¨æƒ…å†µè°ƒæ•´

éœ€è¦æˆ‘å¼€å§‹å®æ–½ç¬¬ä¸€é˜¶æ®µï¼ˆåŸºç¡€è®¤è¯ç³»ç»Ÿï¼‰å—ï¼Ÿ
