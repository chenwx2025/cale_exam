import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function addPulseDiagnosis() {
  try {
    // 查找Domain 1分类
    const category = await prisma.category.findFirst({
      where: { code: 'DOMAIN_1_ASSESSMENT' }
    })

    if (!category) {
      console.log('❌ 未找到Domain 1分类')
      return
    }

    // 解析现有知识点
    let keyPoints = []
    if (category.keyPoints) {
      try {
        keyPoints = JSON.parse(category.keyPoints)
      } catch (e) {
        console.log('❌ 解析现有知识点失败')
        return
      }
    }

    // 创建脉诊知识点
    const pulseDiagnosis = {
      title: '脉诊要点',
      description: '脉诊是中医四诊之一，通过切脉了解人体气血、脏腑、经络的盛衰虚实。掌握28种常见脉象的特征、主病及临床意义，是中医诊断的基本功。',
      detailedExplanation: `一、脉诊基础

【寸关尺定位】
• 寸部：候上焦（心肺）
• 关部：候中焦（脾胃肝胆）
• 尺部：候下焦（肾膀胱）

【脉诊要素】
• 位置：浮、中、沉
• 至数：迟、数、缓、疾
• 形态：大小、长短、粗细
• 力度：有力、无力
• 流利：滑、涩
• 节律：规则、不规则

【脉诊方法】
• 时间：清晨未食前最佳
• 体位：平卧或正坐，前臂与心脏同高
• 指法：三指平布，中指对关，指腹切脉
• 步骤：先举后按，先浮后沉，先总后分

二、28种常见脉象分类

【按位置分类】
一、浮脉类（轻取即得）：浮、洪、濡、散
二、沉脉类（重按始得）：沉、牢、弱、伏

【按至数分类】
三、迟脉类（一息不足四至）：迟、涩、缓、结
四、数脉类（一息五至以上）：数、疾、促、动

【按力度分类】
五、虚脉类（应指无力）：虚、细、微、弱、濡、散、代
六、实脉类（应指有力）：实、滑、弦、紧、长、牢

【按形态分类】
七、滑涩类：滑、涩
八、弦类：弦、紧
九、长短类：长、短

三、脉象相兼与复合脉

【常见相兼脉】
• 浮紧脉：表寒证
• 浮数脉：表热证
• 沉迟脉：里寒证
• 沉数脉：里热证
• 弦细脉：肝肾不足
• 滑数脉：痰热证

【病理意义】
• 浮脉主表
• 沉脉主里
• 迟脉主寒
• 数脉主热
• 虚脉主虚
• 实脉主实

四、脉诊与八纲辨证

【表里辨脉】
• 表证：脉浮
• 里证：脉沉

【寒热辨脉】
• 寒证：脉迟
• 热证：脉数

【虚实辨脉】
• 虚证：脉虚无力
• 实证：脉实有力

【阴阳辨脉】
• 阳证：浮、数、滑、实
• 阴证：沉、迟、涩、弱

五、脉症合参

【脉证相符】
顺证：脉象与证候相符合，预后良好

【脉证不符】
逆证：脉象与证候不相符，预后较差
• 真脏脉现：病情危重
• 脉证相反：需四诊合参

【从舍法则】
• 舍证从脉：证假脉真
• 舍脉从证：脉假证真

六、特殊脉象的临床意义

【妊娠脉】
• 滑脉：妊娠之征
• 脉滑数：胎热
• 脉滑迟：胎寒

【胃气脉】
• 有胃气：脉来不急不缓，和缓有力
• 无胃气：脉来急数或极缓，预后不良

【真脏脉】
• 无胃、无神、无根
• 主病情危重，预后不良`,

      clinicalCases: [
        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例1：浮紧脉 - 外感风寒
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   患者恶寒重，发热轻，无汗，头身疼痛，舌苔薄白

🔍 【脉象特征】
   脉浮紧：轻取即得（浮），脉来绷急如转索（紧）

💊 【病机分析】
   风寒外束，卫阳被遏，营卫失和
   浮脉主表，紧脉主寒主痛

📝 【治疗原则】
   辛温解表，发汗散寒

💡 【方药应用】
   麻黄汤加减

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例2：沉迟脉 - 阳虚里寒
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   畏寒肢冷，腹痛喜温喜按，面色㿠白，小便清长

🔍 【脉象特征】
   脉沉迟：重按始得（沉），一息不足四至（迟）

💊 【病机分析】
   阳气虚衰，阴寒内盛
   沉脉主里，迟脉主寒主虚

📝 【治疗原则】
   温阳散寒，健脾益气

💡 【方药应用】
   附子理中丸

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例3：弦细数脉 - 肝肾阴虚
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   头晕目眩，耳鸣，腰膝酸软，五心烦热，盗汗

🔍 【脉象特征】
   脉弦细数：端直以长如按琴弦（弦），脉细如线（细），一息五至（数）

💊 【病机分析】
   肝肾阴虚，虚火内扰
   弦脉主肝，细脉主虚，数脉主热

📝 【治疗原则】
   滋补肝肾，育阴清热

💡 【方药应用】
   六味地黄丸加减

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例4：滑数脉 - 痰热壅肺
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   咳嗽气喘，痰黄稠厚，发热，口渴，舌红苔黄

🔍 【脉象特征】
   脉滑数：往来流利如盘走珠（滑），一息五至以上（数）

💊 【病机分析】
   痰热壅肺，肺失宣降
   滑脉主痰，数脉主热

📝 【治疗原则】
   清热化痰，宣肺平喘

💡 【方药应用】
   清金化痰汤

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例5：代脉 - 心气虚弱
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   心悸气短，神疲乏力，面色苍白，活动后加重

🔍 【脉象特征】
   脉代：脉来一止，止有定数（代脉）

💊 【病机分析】
   心气虚衰，脉气不续
   代脉主脏气衰微

📝 【治疗原则】
   补益心气，养心安神

💡 【方药应用】
   炙甘草汤

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例6：洪脉 - 气分实热
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   壮热，大汗，大渴，面红目赤，烦躁，舌红苔黄

🔍 【脉象特征】
   脉洪：脉来如波涛汹涌，来盛去衰（洪脉）

💊 【病机分析】
   邪热亢盛，气血沸腾
   洪脉主热盛

📝 【治疗原则】
   清热生津，泻火除烦

💡 【方药应用】
   白虎汤

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`
      ],

      keyFormulas: [
        `【浮脉】
特征：轻取即得，重按稍减，如水漂木
主病：表证
• 浮紧：表寒证（恶寒重，无汗）
• 浮数：表热证（发热重，咽痛）
• 浮缓：表虚证（自汗，恶风）
相关方：麻黄汤、桂枝汤、银翘散`,

        `【沉脉】
特征：重按始得，轻取不应，如石沉水底
主病：里证
• 沉迟：里寒证（腹痛喜温）
• 沉数：里热证（便秘口渴）
• 沉弱：里虚证（气短乏力）
相关方：附子理中丸、大承气汤`,

        `【迟脉】
特征：一息不足四至（每分钟脉搏少于60次）
主病：寒证
• 迟而有力：实寒证（冷痛拒按）
• 迟而无力：虚寒证（隐痛喜按）
相关方：四逆汤、理中丸`,

        `【数脉】
特征：一息五至以上（每分钟脉搏90次以上）
主病：热证
• 数而有力：实热证（高热便秘）
• 数而无力：虚热证（潮热盗汗）
相关方：白虎汤、清骨散`,

        `【虚脉】
特征：三部脉举按皆无力，应指松软
主病：虚证（气血两虚）
症状：面色苍白、神疲乏力、气短懒言
相关方：八珍汤、十全大补汤`,

        `【实脉】
特征：三部脉举按皆有力，充实有神
主病：实证（邪气盛）
症状：发热、腹满胀痛拒按、大便秘结
相关方：大承气汤、小承气汤`,

        `【滑脉】
特征：往来流利，如盘走珠，应指圆滑
主病：痰饮、食积、实热
• 妇女：妊娠之征
• 青壮年：气血充盛，属正常脉
相关方：二陈汤、保和丸`,

        `【涩脉】
特征：往来艰涩不畅，如轻刀刮竹
主病：气滞、血瘀、精血亏少
症状：胸胁胀痛、月经不调、肌肤甲错
相关方：血府逐瘀汤、桃红四物汤`,

        `【弦脉】
特征：端直以长，如按琴弦
主病：肝胆病、痛证、痰饮
• 弦细：肝肾阴虚
• 弦数：肝火上炎
• 弦紧：寒凝疼痛
相关方：四逆散、逍遥散`,

        `【紧脉】
特征：脉来绷急，状如转索
主病：寒证、痛证
• 浮紧：表寒证
• 沉紧：里寒证
相关方：麻黄汤、大黄附子汤`,

        `【洪脉】
特征：脉体阔大，来盛去衰，如波涛汹涌
主病：热盛
常见：气分实热证（壮热、大汗、大渴）
相关方：白虎汤、竹叶石膏汤`,

        `【细脉】
特征：脉细如线，但应指明显
主病：气血两虚、阴虚
• 细数：阴虚内热
• 细弱：气血两虚
相关方：当归补血汤、四物汤`,

        `【濡脉】
特征：浮而细软，轻取即得，重按不明显
主病：虚证、湿证
常见：气血不足、阳虚
相关方：归脾汤、补中益气汤`,

        `【弱脉】
特征：沉而细软，重按始得
主病：气血两虚
症状：阳气虚衰，脏腑功能减退
相关方：四君子汤、肾气丸`,

        `【长脉】
特征：脉体较长，超过本位
主病：阳证、热证、实证
• 长而有力：阳盛实热
• 长而无力：阳虚
相关方：白虎汤、黄连解毒汤`,

        `【短脉】
特征：脉体较短，不及本位
主病：气虚、气郁
症状：气机不舒，气血运行不畅
相关方：四君子汤、越鞠丸`,

        `【促脉】
特征：脉来急数，时有一止，止无定数
主病：阳盛实热、气血痰食停滞
常见：痰热壅肺、瘀血内阻
相关方：清营汤、血府逐瘀汤`,

        `【结脉】
特征：脉来缓慢，时有一止，止无定数
主病：阴盛气结、寒痰血瘀
常见：心脉瘀阻、痰饮内停
相关方：瓜蒌薤白白酒汤`,

        `【代脉】
特征：脉来一止，止有定数，良久复来
主病：脏气衰微、疼痛、惊恐、跌打损伤
• 久病见代脉：预后不良
• 孕妇见代脉：胎动不安
相关方：炙甘草汤`,

        `【疾脉】
特征：一息七八至，脉来急疾
主病：阳极阴竭、元气欲脱
病情危重，预后不良`,

        `【动脉】
特征：脉短如豆，滑数有力
主病：痛、惊、恐
常见：惊恐、疼痛剧烈
相关方：桂枝加桂汤`,

        `【牢脉】
特征：沉而有力，坚牢不移
主病：阴寒内实、疝气、癥瘕
症状：寒邪凝结，气血瘀滞
相关方：大黄附子汤`,

        `【散脉】
特征：浮大无根，至数不齐，如杨花散漫
主病：元气离散，脏腑精气将绝
病情危重，预后不良`,

        `【伏脉】
特征：重按推筋着骨始得
主病：邪闭、厥证、痛极
症状：邪气闭阻，气机郁遏
相关方：四逆散、苏合香丸`,

        `【微脉】
特征：极细极软，似有似无，欲绝非绝
主病：气血大虚、阳气衰微
病情危重，预后不良
相关方：参附汤、独参汤`,

        `【缓脉】
特征：一息四至，脉来和缓
• 有胃气：正常脉象
• 无力而缓：脾胃虚弱、湿邪困脾
相关方：参苓白术散`,

        `【革脉】
特征：浮而搏指，中空外坚，如按鼓皮
主病：亡血、失精、半产、漏下
常见：精血严重亏虚
相关方：大补元煎`,

        `【芤脉】
特征：浮大中空，如按葱管
主病：失血、伤阴
常见：大出血后
相关方：独参汤、四物汤`
      ],

      commonMistakes: [
        '❌ 错误：只凭一次脉诊就下结论\n✅ 正确：需要多次切脉，结合四诊合参，综合判断',
        '❌ 错误：脉浮就是表证\n✅ 正确：虚阳外越、大失血后也可见浮脉，需结合症状',
        '❌ 错误：脉数就是热证\n✅ 正确：虚劳、久病、小儿也可见数脉，需辨虚实',
        '❌ 错误：只看脉象不看舌象\n✅ 正确：舌脉合参，互相印证，才能准确辨证',
        '❌ 错误：脉沉就是病重\n✅ 正确：沉脉主里证，不一定病重，需看有力无力',
        '❌ 错误：代脉都是危重症\n✅ 正确：久病体虚、疼痛剧烈、孕妇也可见代脉，需综合分析',
        '❌ 错误：切脉时用力过重或过轻\n✅ 正确：应先浮后沉，轻、中、重三部都要切到'
      ],

      visualDiagram: `
        脉诊17种脉象分类图

        ┌─────────────────────────────────────────┐
        │           28种常见脉象                    │
        └─────────────────────────────────────────┘
                         │
        ┌────────────────┼────────────────┐
        │                │                │
      浮脉类          沉脉类          迟数类
    (轻取即得)      (重按始得)      (至数异常)
        │                │                │
    ┌───┴───┐      ┌───┴───┐      ┌───┴───┐
    浮 洪 濡 散      沉 牢 弱 伏      迟 缓 数 疾

        │                │                │
      虚脉类          实脉类          特殊脉
    (应指无力)      (应指有力)      (形态特殊)
        │                │                │
    ┌───┴───┐      ┌───┴───┐      ┌───┴───┐
    虚 细 微 代      实 滑 弦 长      促 结 动 革

    【脉诊口诀】
    浮脉主表沉主里，迟寒数热要牢记
    虚脉无力主虚证，实脉有力实证宜
    滑主痰饮涩血瘀，弦为肝病痛证依
    洪脉热盛细血少，四诊合参莫分离
      `
    }

    // 添加到知识点列表
    keyPoints.push(pulseDiagnosis)

    // 更新数据库
    await prisma.category.update({
      where: { id: category.id },
      data: {
        keyPoints: JSON.stringify(keyPoints)
      }
    })

    console.log('✅ 脉诊知识点已成功添加！')
    console.log('\n📊 知识点详情：')
    console.log('  标题：脉诊要点')
    console.log('  位置：Domain 1 - Assessment（评估与诊断）')
    console.log(`  知识点序号：第 ${keyPoints.length} 个`)
    console.log('\n📋 内容统计：')
    console.log(`  • 详细解释：6个主要章节`)
    console.log(`  • 临床案例：${pulseDiagnosis.clinicalCases.length} 个`)
    console.log(`  • 关键脉象：${pulseDiagnosis.keyFormulas.length} 种（含详细组成）`)
    console.log(`  • 常见错误：${pulseDiagnosis.commonMistakes.length} 个`)
    console.log('\n💡 包含内容：')
    console.log('  ✓ 脉诊基础（寸关尺、脉诊要素、脉诊方法）')
    console.log('  ✓ 28种常见脉象详解')
    console.log('  ✓ 脉象相兼与复合脉')
    console.log('  ✓ 脉诊与八纲辨证')
    console.log('  ✓ 脉症合参原则')
    console.log('  ✓ 特殊脉象的临床意义')
    console.log('  ✓ 6个典型案例（浮紧、沉迟、弦细数、滑数、代、洪）')
    console.log('  ✓ 脉诊分类图谱')

  } catch (error) {
    console.error('添加失败:', error)
  } finally {
    await prisma.$disconnect()
  }
}

addPulseDiagnosis()
