import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function addWuXingTreatmentMethods() {
  try {
    // 查找Domain 1分类
    const category = await prisma.category.findFirst({
      where: { code: 'DOMAIN_1_ASSESSMENT' }
    })

    if (!category) {
      console.log('❌ 未找到Domain 1分类')
      return
    }

    // 解析现有知识点
    let keyPoints = []
    if (category.keyPoints) {
      try {
        keyPoints = JSON.parse(category.keyPoints)
      } catch (e) {
        console.log('❌ 解析现有知识点失败')
        return
      }
    }

    // 查找五行学说知识点
    const wuxingIndex = keyPoints.findIndex((p: any) => p.title === '五行学说')

    if (wuxingIndex === -1) {
      console.log('❌ 未找到五行学说知识点')
      return
    }

    // 添加治疗方法到详细解释中
    const additionalContent = `

六、五行辨证治则

【正治和反治】
• 正治：逆其证候性质而治（热者寒之、寒者热之）
• 反治：顺从疾病假象而治（寒因寒用、热因热用）

【治病求本】
• 急则治其标：急性症状先处理
• 缓则治其本：慢性疾病治根本
• 标本兼治：标本同病，标本同治

【扶正祛邪】
• 扶正：补虚扶正，增强抗病能力
• 祛邪：泻实祛邪，祛除病邪
• 扶正祛邪并用：虚实夹杂时

七、五行治法应用

【滋水涵木】
• 原理：益水之源，以消阳光
• 适应证：肝肾阴虚证
• 治则：滋养肾阴以涵养肝木
• 代表方：六味地黄丸、杞菊地黄丸
• 临床表现：头晕目眩、腰膝酸软、五心烦热、口干咽燥

【益火补土】
• 原理：温补肾阳以助脾阳
• 适应证：脾肾阳虚证
• 治则：温肾阳以补脾阳（火生土）
• 代表方：附子理中丸、四神丸
• 临床表现：畏寒肢冷、腹痛腹泻、五更泄泻、腰膝冷痛

【培土生金】
• 原理：健脾益气以补肺
• 适应证：脾肺气虚证
• 治则：健脾益气以补益肺气（土生金）
• 代表方：补中益气汤、参苓白术散
• 临床表现：少气懒言、咳嗽无力、食少便溏、面色萎黄

【金水相生】
• 原理：滋养肺肾之阴
• 适应证：肺肾阴虚证
• 治则：滋养肺肾阴液（金生水、金水同源）
• 代表方：百合固金汤、麦味地黄丸
• 临床表现：干咳少痰、潮热盗汗、腰膝酸软、咽干口燥

【佐金平木】
• 原理：清肺金以平肝木
• 适应证：肝火犯肺证
• 治则：清肺金制约肝木（金克木）
• 代表方：黛蛤散、泻白散
• 临床表现：胁肋胀痛、咳嗽气逆、痰中带血、烦躁易怒

【泻南补北】
• 原理：泻心火、滋肾水
• 适应证：心肾不交证
• 治则：清心火、滋肾水、交通心肾
• 代表方：黄连阿胶汤、交泰丸
• 临床表现：心烦失眠、心悸不安、腰膝酸软、遗精盗汗

【抑木扶土】
• 原理：疏肝健脾
• 适应证：肝郁脾虚证
• 治则：疏肝理气、健脾益气（抑制木克土）
• 代表方：逍遥散、痛泻要方
• 临床表现：胸胁胀满、情志抑郁、腹痛腹泻、食少纳呆

【培土制水】
• 原理：健脾以制水湿
• 适应证：脾虚水泛证
• 治则：健脾运化、利水消肿（土克水）
• 代表方：实脾饮、五苓散
• 临床表现：水肿、腹胀、小便不利、大便溏泻

八、五脏病证治法举例

【肝病治法】
• 实则泻其子：肝实（肝火旺）→ 泻心火
  - 方药：龙胆泻肝汤（龙胆草、栀子、黄芩）
• 虚则补其母：肝虚（肝血虚）→ 补肾精
  - 方药：左归丸（熟地、山萸肉、枸杞）

【心病治法】
• 实则泻其子：心实（心火亢）→ 泻脾土
  - 方药：导赤散（生地、木通、竹叶）
• 虚则补其母：心虚（心血虚）→ 补肝血
  - 方药：归脾汤（当归、龙眼肉、黄芪）

【脾病治法】
• 实则泻其子：脾实（湿热）→ 泻肺金
  - 方药：葛根芩连汤
• 虚则补其母：脾虚（脾气虚）→ 补心火
  - 方药：归脾汤（人参、黄芪、白术）

【肺病治法】
• 实则泻其子：肺实（痰热）→ 泻肾水
  - 方药：清金化痰汤
• 虚则补其母：肺虚（肺气虚）→ 补脾土
  - 方药：补中益气汤、参苓白术散

【肾病治法】
• 实则泻其子：肾实（湿热）→ 泻肝木
  - 方药：龙胆泻肝汤
• 虚则补其母：肾虚（肾精虚）→ 补肺金
  - 方药：金匮肾气丸、河车大造丸
`

    // 补充更多临床案例
    const additionalCases = [
      '案例9：滋水涵木法\n【症状】肝肾阴虚，头晕目眩、腰膝酸软、五心烦热、口干\n【病机】肾阴不足，不能滋养肝木，肝阴亦虚\n【治则】滋肾阴以涵养肝木\n【方药】杞菊地黄丸（六味地黄丸+枸杞、菊花）\n【分析】补肾为主，兼养肝明目',

      '案例10：益火补土法\n【症状】脾肾阳虚，畏寒肢冷、五更泄泻、腹痛喜按\n【病机】肾阳不足，不能温煦脾阳，脾失健运\n【治则】温补肾阳以助脾阳\n【方药】四神丸（补骨脂、肉豆蔻、五味子、吴茱萸）\n【分析】温肾暖脾，涩肠止泻',

      '案例11：培土生金法\n【症状】脾肺气虚，少气懒言、咳嗽无力、食少便溏\n【病机】脾气虚弱，不能生肺金，肺气亦虚\n【治则】健脾益气以补肺气\n【方药】补中益气汤（黄芪、人参、白术、升麻、柴胡）\n【分析】补脾为主，升举中气，益肺气',

      '案例12：金水相生法\n【症状】肺肾阴虚，干咳少痰、潮热盗汗、腰膝酸软\n【病机】肺肾阴液不足，虚火内扰\n【治则】滋养肺肾阴液\n【方药】百合固金汤（百合、生地、熟地、麦冬、贝母）\n【分析】滋肺肾阴，清虚热',

      '案例13：泻南补北法\n【症状】心肾不交，心烦失眠、遗精盗汗、腰膝酸软\n【病机】肾阴不足，心火独亢，心肾不交\n【治则】滋肾阴、清心火、交通心肾\n【方药】黄连阿胶汤（黄连、黄芩、阿胶、白芍）\n【分析】泻南方心火，补北方肾水'
    ]

    // 补充关键公式
    const additionalFormulas = [
      '滋水涵木公式：肾阴虚→肝阴虚 = 补肾阴（六味地黄丸）',
      '益火补土公式：肾阳虚→脾阳虚 = 温肾阳（四神丸）',
      '培土生金公式：脾气虚→肺气虚 = 健脾气（补中益气汤）',
      '金水相生公式：肺阴虚+肾阴虚 = 滋肺肾阴（百合固金汤）',
      '佐金平木公式：肝火旺→犯肺 = 清肺平肝（黛蛤散）',
      '泻南补北公式：心火亢+肾阴虚 = 清心滋肾（黄连阿胶汤）',
      '肝实治法：泻心火（龙胆泻肝汤）；肝虚治法：补肾精（左归丸）',
      '心实治法：导火下行（导赤散）；心虚治法：补肝血（归脾汤）',
      '脾实治法：清热燥湿；脾虚治法：补心火、健脾气（归脾汤）',
      '肺实治法：清金化痰；肺虚治法：补脾土（参苓白术散）',
      '肾实治法：清热利湿；肾虚治法：补肺金、温肾阳（金匮肾气丸）'
    ]

    // 更新五行学说知识点
    keyPoints[wuxingIndex].detailedExplanation += additionalContent
    keyPoints[wuxingIndex].clinicalCases = [
      ...keyPoints[wuxingIndex].clinicalCases,
      ...additionalCases
    ]
    keyPoints[wuxingIndex].keyFormulas = [
      ...keyPoints[wuxingIndex].keyFormulas,
      ...additionalFormulas
    ]

    // 更新数据库
    await prisma.category.update({
      where: { id: category.id },
      data: {
        keyPoints: JSON.stringify(keyPoints)
      }
    })

    console.log('✅ 五行学说治疗方法已成功添加！')
    console.log('新增内容：')
    console.log('  📖 详细解释：新增了六大治则和九大治法')
    console.log('  🏥 临床案例：新增5个案例（总共13个）')
    console.log('  🔑 关键公式：新增11个公式（总共22个）')
    console.log('\n新增治法包括：')
    console.log('  1. 滋水涵木 - 六味地黄丸、杞菊地黄丸')
    console.log('  2. 益火补土 - 四神丸、附子理中丸')
    console.log('  3. 培土生金 - 补中益气汤、参苓白术散')
    console.log('  4. 金水相生 - 百合固金汤、麦味地黄丸')
    console.log('  5. 佐金平木 - 黛蛤散')
    console.log('  6. 泻南补北 - 黄连阿胶汤、交泰丸')
    console.log('  7. 抑木扶土 - 逍遥散、痛泻要方')
    console.log('  8. 培土制水 - 实脾饮、五苓散')
    console.log('  9. 五脏病治法（实则泻其子、虚则补其母）')

  } catch (error) {
    console.error('更新失败:', error)
  } finally {
    await prisma.$disconnect()
  }
}

addWuXingTreatmentMethods()
