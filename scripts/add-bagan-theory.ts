import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function addBaGanTheory() {
  try {
    // 查找Domain 1分类
    const category = await prisma.category.findFirst({
      where: { code: 'DOMAIN_1_ASSESSMENT' }
    })

    if (!category) {
      console.log('❌ 未找到Domain 1分类')
      return
    }

    // 解析现有知识点
    let keyPoints = []
    if (category.keyPoints) {
      try {
        keyPoints = JSON.parse(category.keyPoints)
      } catch (e) {
        console.log('❌ 解析现有知识点失败')
        return
      }
    }

    // 创建八纲辨证知识点
    const baGanTheory = {
      title: '八纲辨证',
      description: '八纲辨证是中医辨证论治的总纲，包括阴阳、表里、寒热、虚实四对纲领，用于概括和分析疾病的基本属性、病位深浅、病性寒热和正邪盛衰，是中医诊断的核心方法。',

      detailedExplanation: `
一、八纲辨证概述

【八纲的组成】
• 阴阳：总纲，概括其他六纲
• 表里：辨别病位的深浅和病势的趋向
• 寒热：辨别疾病的性质
• 虚实：辨别邪正盛衰

【八纲的关系】
• 阴阳为总纲：表、热、实属阳；里、寒、虚属阴
• 表里辨病位：表证病位浅，里证病位深
• 寒热辨病性：寒证属阴寒，热证属阳热
• 虚实辨邪正：虚证正气虚，实证邪气盛

二、表里辨证

【表证】（外邪入侵，皮肤/肌肉/经络）
起病特点：起病急、恶寒、发热、身痛、项强、脉浮

（一）表寒证
• 症状：恶寒重，发热轻或不发热，无汗，舌淡白，脉浮紧
• 治则：辛温解表
• 方药：麻黄汤

（二）表热证
• 症状：恶寒轻发热重，微汗，口渴，咽痛白或薄黄，脉浮数
• 治则：辛凉解表
• 方药：银翘散

（三）表实证
• 症状：无汗，身痛重，脉浮紧
• 治则：发汗解表
• 方药：麻黄汤

（四）表虚证
• 症状：汗多，身痛轻，脉浮缓
• 治则：调和营卫
• 方药：桂枝汤

【里证】（病在经络、脏腑、气血/脏腑/气血）
特点：病在经络、脏腑，症状复杂多样

（一）里证不同类型
• 外邪直入
• 情志内伤，饮食劳倦，直接伤于里
• 表证不愈，内传于里

三、寒热辨证

【寒证】（阴盛则寒则阳虚）

（一）实寒证（阴寒内盛）
• 症状：恶寒，腹冷，口不渴喜热饮，面白，腹痛拒按，大便清薄，小便清长，舌苔白腻，脉沉紧实
• 病机：寒邪内盛，阳气被遏
• 治则：温里散寒
• 方药：大黄附子汤

（二）虚寒证（阳虚则寒）
• 症状：恶寒肢冷，面色苍白，腹痛喜按，口不渴，倦怠，小便清长，舌淡白，脉沉迟而弱
• 病机：阳气虚衰，温煦失职
• 治则：温补阳气
• 方药：附子理中丸、肾气丸

【热证】（阳盛则热或阴虚则热）

（一）实热证（阳盛则热）
• 症状：发热口渴，面红目赤，大便秘结，小便短赤，舌红苔黄，脉数有力
• 病机：阳热亢盛，热毒内蕴
• 治则：清热泻火
• 方药：白虎汤

（二）虚热证（阴虚则热）
• 症状：午后发热，或有低热，夜晚阴盛时退热；五心烦热，盗汗，两颧红赤，大便干燥，小便短赤，舌红少苔，脉细数
• 病机：阴液亏虚，虚火内扰
• 治则：滋阴清热
• 方药：青蒿鳖甲汤

四、虚实辨证

【实证】（邪气盛）
• 特点：脏腑功能失调（痰饮/水湿/痰血）
• 气滞证：面白，声低，自汗，动则尤甚，呼吸气短，倦怠，纳呆，脉虚
• 血虚证：面色苍白，唇淡，目眩，头晕失眠，舌淡脉细
• 阴虚证：面色白潮，舌红，脉冷，口不渴或喜热饮，便溏，尿频色淡，脉沉迟弱
• 阳虚证：面色苍白，唇淡，目眩，头晕失眠，脉沉细数

【虚证】（感受外邪所致的病证）
• 实证：脏腑功能失调（痰饮/水湿/痰血）

五、阴阳辨证

【阳证】
• 病位：在表、在气（脏腑）
• 病性：属热
• 病势：属实
• 特征：面红，声高，呼吸气粗，口渴喜冷饮，便秘，尿赤短，舌红苔黄，脉数有力

【阴证】
• 病位：在里、在血（脏腑）
• 病性：属寒
• 病势：属虚
• 特征：面白，声低，呼吸微弱，口淡不渴或喜热饮，便溏，尿清长，舌淡苔白，脉沉迟无力

六、八纲辨证的复杂证候

【寒热错杂】
• 体内阴阳过盛：过食辛辣—胃热，肝热
• 情志因素：气郁化热—肝热，心热
• 外邪化热传里：寒邪入里—衍热/胃/肠高热，大汗，口渴

【真假寒热】
• 真寒假热：内寒外热（内有真寒而外见假热）
  - 症状：外邪化热传里（衍热/胃/肠）高热，大汗，口渴
  - 病机：阳虚于内，格阴于外

• 真热假寒：内热外寒（内有真热而外见假寒）
  - 症状：真寒假热—阴寒内盛，温热子外（内有真寒而外见假热）
  - 病机：热极阴伤，阳郁于外无法外达（内有真热而外见假寒）

【虚实夹杂】
• 以虚为主，兼有实邪
• 以实为主，兼有正虚
• 虚实并重
• 虚实转化

【表里同病】
• 表证未解，里证已现
• 里证未愈，复感外邪

七、八纲辨证的临床意义

【指导诊断】
• 明确病位：表里
• 判断病性：寒热
• 辨别邪正：虚实
• 总括病证：阴阳

【指导治疗】
• 表证用解表法
• 里证用治里法
• 寒证用温法
• 热证用清法
• 虚证用补法
• 实证用泻法
`,

      examples: [
        '表寒证：恶寒重、发热轻、无汗、脉浮紧 → 麻黄汤',
        '表热证：发热重、恶寒轻、有汗、咽痛、脉浮数 → 银翘散',
        '里实热证：高热、口渴、便秘、舌红苔黄、脉数有力 → 白虎汤',
        '里虚寒证：畏寒肢冷、腹痛喜按、便溏、脉沉迟 → 附子理中丸',
        '阴虚证：五心烦热、盗汗、舌红少苔、脉细数 → 六味地黄丸',
        '阳虚证：畏寒肢冷、面色苍白、舌淡苔白、脉沉迟 → 肾气丸',
        '气虚证：神疲乏力、气短懒言、自汗、脉虚 → 四君子汤',
        '血虚证：面色苍白、头晕目眩、失眠、脉细 → 四物汤'
      ],

      clinicalCases: [
        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例1: 表寒证（太阳伤寒）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   恶寒重，发热轻或不发热，无汗，头痛，身痛，舌淡苔白，脉浮紧

🔍 【病机分析】
   风寒束表，卫阳被遏，营卫失和，腠理闭塞

💊 【治疗原则】
   辛温解表，发汗散寒

📝 【方药处方】
   麻黄汤（麻黄、桂枝、杏仁、甘草）

💡 【临床要点】
   表寒证的特点是"恶寒重、无汗、脉紧"，与表热证的"发热重、有汗、脉数"相鉴别

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例2: 表热证（太阳温病）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   发热重，微恶风寒，有汗或少汗，咽痛，口渴，舌边尖红，脉浮数

🔍 【病机分析】
   风热犯表，卫气不固，热伤津液

💊 【治疗原则】
   辛凉解表，清热生津

📝 【方药处方】
   银翘散（银花、连翘、薄荷、牛蒡子、桔梗、竹叶、甘草、荆芥、淡豆豉、芦根）

💡 【临床要点】
   表热证强调"发热重、咽痛、口渴"，用辛凉解表法，忌用辛温发汗

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例3: 里实热证（阳明腑实）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   高热，口渴喜冷饮，大便秘结，腹痛拒按，小便短赤，舌红苔黄燥，脉沉实有力

🔍 【病机分析】
   阳明热盛，燥屎内结，腑气不通

💊 【治疗原则】
   泻热通便，釜底抽薪

📝 【方药处方】
   大承气汤（大黄、芒硝、厚朴、枳实）

💡 【临床要点】
   里实热证"四大主症"：高热、汗出、口渴、便秘；脉象沉实有力是关键

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例4: 里虚寒证（脾胃虚寒）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   畏寒肢冷，腹痛喜温喜按，呕吐清水，大便溏泄，舌淡苔白，脉沉细无力

🔍 【病机分析】
   脾胃阳虚，寒从中生，运化失职

💊 【治疗原则】
   温中健脾，散寒止痛

📝 【方药处方】
   附子理中丸（附子、人参、白术、干姜、甘草）

💡 【临床要点】
   虚寒证特点是"喜温喜按、脉沉细"，与实寒证"拒按、脉沉紧"相鉴别

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例5: 阴虚证（肝肾阴虚）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   午后潮热，五心烦热，盗汗，两颧潮红，腰膝酸软，舌红少苔，脉细数

🔍 【病机分析】
   肝肾阴液亏虚，虚火内扰，阴不制阳

💊 【治疗原则】
   滋补肝肾，育阴潜阳

📝 【方药处方】
   六味地黄丸（熟地、山萸肉、山药、泽泻、茯苓、丹皮）

💡 【临床要点】
   阴虚证的"五心烦热、盗汗、舌红少苔"是典型特征，与阳虚证相反

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`,

        `━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  案例6: 真寒假热证（阴盛格阳）
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 【症状表现】
   面红，烦躁，但欲盖衣被；口渴但喜热饮或不欲饮；下利清谷，小便清长；四肢厥冷，脉沉细微

🔍 【病机分析】
   阴寒内盛，真阳被格于外，形成"内真寒而外假热"

💊 【治疗原则】
   温里散寒，引火归元

📝 【方药处方】
   四逆汤（附子、干姜、甘草）或白通汤

💡 【临床要点】
   鉴别真假寒热的关键：看"欲盖衣被、喜热饮、脉象沉细"等真实证据，不被假象迷惑

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━`
      ],

      keyFormulas: [
        '八纲总纲：阴（里、寒、虚）、阳（表、热、实）',
        '表证三特征：起病急、恶寒发热、脉浮',
        '里证特点：病位深，症状多样，无恶寒发热',
        '实寒证公式：寒邪+拒按+脉沉紧 = 温里散寒（大黄附子汤）',
        '虚寒证公式：阳虚+喜按+脉沉迟 = 温补阳气（附子理中丸）',
        '实热证公式：高热+口渴+便秘+脉数有力 = 清热泻火（白虎汤）',
        '虚热证公式：潮热+盗汗+舌红少苔+脉细数 = 滋阴清热（青蒿鳖甲汤）',
        '表寒证：麻黄汤（麻黄、桂枝、杏仁、甘草）',
        '表热证：银翘散（辛凉解表）',
        '表虚证：桂枝汤（调和营卫）',
        '真寒假热鉴别：欲盖衣被+喜热饮+脉沉细 = 内真寒',
        '真热假寒鉴别：四肢厥冷但烦躁+口渴+脉沉实 = 内真热',
        '气虚证：神疲乏力+气短+自汗+脉虚 = 四君子汤',
        '血虚证：面色苍白+失眠+脉细 = 四物汤',
        '阴虚证：五心烦热+盗汗+舌红少苔 = 六味地黄丸',
        '阳虚证：畏寒肢冷+便溏+脉沉迟 = 肾气丸'
      ],

      commonMistakes: [
        '❌ 错误：表证一定有发热\n✅ 正确：表寒证可以"发热轻或不发热"，关键看"恶寒、脉浮"',

        '❌ 错误：有热就是热证，有寒就是寒证\n✅ 正确：要辨别真假寒热，如"真寒假热"内寒外热，治疗要温里不能清热',

        '❌ 错误：虚证就用补法，实证就用泻法\n✅ 正确：要看虚实夹杂情况，可能需要"补中有泻"或"泻中有补"',

        '❌ 错误：八纲辨证是独立的辨证方法\n✅ 正确：八纲是总纲，要结合脏腑、气血、经络等辨证方法综合判断',

        '❌ 错误：面红、烦躁就是热证\n✅ 正确：要警惕"真寒假热"，看是否"欲盖衣被、喜热饮、脉沉细"',

        '❌ 错误：表证用解表法就够了\n✅ 正确：要辨别表寒、表热、表虚、表实，用不同解表法',

        '❌ 错误：阴虚和阳虚只看怕冷怕热\n✅ 正确：阴虚是"五心烦热、盗汗、舌红少苔"；阳虚是"畏寒肢冷、便溏、舌淡苔白"'
      ],

      visualDiagram: `
┌─────────────────────────────────────────────────────────┐
│                    八纲辨证总图                          │
│                                                         │
│                      阴 阳（总纲）                       │
│                     /        \\                          │
│                表 里      寒 热      虚 实              │
│               /    \\      /   \\      /   \\              │
│            表寒  表热  实寒 虚寒  实热 虚热  气虚 血虚    │
│            表实  表虚              阴虚 阳虚            │
│                                                         │
│  辨别方法：                                             │
│  • 表里 → 看病位深浅（表：浅层；里：深层）              │
│  • 寒热 → 看病性属性（寒：阴寒；热：阳热）              │
│  • 虚实 → 看邪正盛衰（虚：正虚；实：邪盛）              │
│  • 阴阳 → 总括以上（阴：里寒虚；阳：表热实）            │
└─────────────────────────────────────────────────────────┘

表证特点：恶寒、发热、脉浮 → 病位在表
里证特点：无恶寒发热、症状复杂 → 病位在里

寒证特点：畏寒、喜热、脉迟 → 病性属寒
热证特点：发热、口渴、脉数 → 病性属热

虚证特点：喜按、脉虚 → 正气虚
实证特点：拒按、脉实 → 邪气盛

阴证 = 里 + 寒 + 虚
阳证 = 表 + 热 + 实
`
    }

    // 将八纲辨证插入到辨证论治之后（第7个位置）
    keyPoints.splice(6, 0, baGanTheory)

    // 更新数据库
    await prisma.category.update({
      where: { id: category.id },
      data: {
        keyPoints: JSON.stringify(keyPoints)
      }
    })

    console.log('✅ 八纲辨证知识点已成功添加！')
    console.log('\n📍 添加位置：Domain 1（评估病人）- 第7个知识点')
    console.log('\n📚 知识点内容：')
    console.log('  1️⃣  八纲辨证概述（阴阳、表里、寒热、虚实）')
    console.log('  2️⃣  表里辨证（表证、里证及其分类）')
    console.log('  3️⃣  寒热辨证（实寒、虚寒、实热、虚热）')
    console.log('  4️⃣  虚实辨证（气血阴阳虚实）')
    console.log('  5️⃣  阴阳辨证（总纲）')
    console.log('  6️⃣  复杂证候（真假寒热、虚实夹杂）')
    console.log('\n🏥 临床案例：6个')
    console.log('  • 案例1：表寒证（麻黄汤）')
    console.log('  • 案例2：表热证（银翘散）')
    console.log('  • 案例3：里实热证（大承气汤）')
    console.log('  • 案例4：里虚寒证（附子理中丸）')
    console.log('  • 案例5：阴虚证（六味地黄丸）')
    console.log('  • 案例6：真寒假热证（四逆汤）')
    console.log('\n🔑 关键公式：16个')
    console.log('  • 包含八纲总纲、各证型鉴别公式')
    console.log('  • 真假寒热鉴别要点')
    console.log('  • 常用方药配伍')
    console.log('\n❗ 常见错误：7个')
    console.log('  • 真假寒热的鉴别')
    console.log('  • 虚实夹杂的处理')
    console.log('  • 表证的辨别要点')

  } catch (error) {
    console.error('添加失败:', error)
  } finally {
    await prisma.$disconnect()
  }
}

addBaGanTheory()
