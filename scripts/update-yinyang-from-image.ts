import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function updateYinYangTheory() {
  console.log('根据教材图片更新阴阳学说知识点...\n')

  // 查找Domain 1分类
  const category = await prisma.category.findFirst({
    where: { code: 'DOMAIN_1_ASSESSMENT' }
  })

  if (!category) {
    console.log('❌ 未找到Domain 1分类')
    return
  }

  // 解析现有知识点
  let keyPoints = []
  if (category.keyPoints) {
    try {
      keyPoints = JSON.parse(category.keyPoints)
    } catch (e) {
      console.log('❌ 解析现有知识点失败')
      return
    }
  }

  // 查找阴阳学说知识点
  const yinYangIndex = keyPoints.findIndex((p: any) => p.title === '阴阳学说')

  // 创建增强版阴阳学说（根据图片内容）
  const enhancedYinYangTheory = {
    title: '阴阳学说',
    description: '阴阳学说是中医理论的哲学基础和核心思想，认为宇宙万物都可归纳为阴阳两个既对立又统一的属性。阴阳之间相互对立、相互依存、相互消长、相互转化，维持着动态平衡。在人体，阴阳平衡代表健康，阴阳失调导致疾病。',
    examples: [
      '阴阳对立：热者寒之，寒者热之（治疗原则体现对立）',
      '阴阳互根：阴在内，阳之守也；阳在外，阴之使也',
      '阴阳消长：阴虚则阳亢，阴盛则阳虚（此消彼长）',
      '阴阳转化：重阴必阳，重阳必阴；寒极生热，热极生寒',
      '病理应用：阴盛阳虚 → 精神乃散；阴平阳秘 → 精神乃治'
    ],
    detailedExplanation: `阴阳学说的核心内容（根据NCCAOM考试要点）：

一、阴阳的对立制约
【病理】阴盛则寒，阳盛则热
【治则】热者寒之，寒者热之

阴阳对立的临床表现：
• 阴盛 → 寒证、实证、沉脉
• 阳盛 → 热证、实证、洪脉
• 寒热并见 → 半表半里证

二、阴阳的互根互用
【生理】阴阳互根，阴阳离决则精气乃绝
【病理】阴损及阳，阳损及阴
【治则】阴中求阳，阳中求阴

具体应用：
• 阴虚 → 可导致阳虚（阴损及阳）
• 阳虚 → 可导致阴虚（阳损及阴）
• 治疗原则：善补阳者必于阴中求阳，善补阴者必于阳中求阴

三、阴阳的消长平衡
【实证】
• 不该有的有了，该去不出（突实）
  - 阴虚则阳亢 → 虚证
  - 阴盛则阳虚 → 实证

【虚证】
• 该有的没了，阴虚则阳亢（虚寒）
  - 阴虚则阳亢 → 阴虚证

正常状态：阴平阳秘，精神乃治

四、阴阳的相互转化
【条件】一定条件下
【过程】量变到质变

临床表现：
• 热极生寒：真热假寒
  - 高热、面赤、脉数 → 四肢厥冷、脉微欲绝
  - 实质：阳盛格阴

• 寒极生热：真寒假热
  - 畏寒、脉微、四肢厥冷 → 面红、口渴
  - 实质：阴盛格阳`,
    visualDiagram: `
┌─────────────────────────────────────────────────┐
│            阴阳学说核心关系图                   │
├─────────────────────────────────────────────────┤
│                                                 │
│  一、阴阳对立                                   │
│  ┌──────────────────────────────┐              │
│  │ 病理：阴盛则寒，阳盛则热     │              │
│  │ 治则：热者寒之，寒者热之     │              │
│  └──────────────────────────────┘              │
│                                                 │
│  二、阴阳互根（相互依存）                       │
│  ┌──────────────────────────────┐              │
│  │ 生理：阴在内，阳之守也       │              │
│  │       阳在外，阴之使也       │              │
│  │ 病理：阴损及阳，阳损及阴     │              │
│  │ 治则：阴中求阳，阳中求阴     │              │
│  └──────────────────────────────┘              │
│                                                 │
│  三、阴阳消长                                   │
│  ┌──────────────────────────────┐              │
│  │ 实证：不该有的有了           │              │
│  │   • 阴虚则阳亢（虚热证）     │              │
│  │   • 阴盛则阳虚（实寒证）     │              │
│  │                              │              │
│  │ 虚证：该有的没了             │              │
│  │   • 阴虚则阳亢（阴虚证）     │              │
│  │   • 阳虚则阴盛（阳虚证）     │              │
│  └──────────────────────────────┘              │
│                                                 │
│  四、阴阳转化                                   │
│  ┌──────────────────────────────┐              │
│  │ 热极生寒，重阳必阴           │              │
│  │ 寒极生热，重阴必阳           │              │
│  └──────────────────────────────┘              │
│                                                 │
└─────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────┐
│          阴阳失调的临床表现对照表               │
├─────────────────────────────────────────────────┤
│                                                 │
│  证型          症状表现              治疗原则   │
│  ────────────────────────────────────────────   │
│  阴盛阳病      寒冷、白虎汤、六味地黄丸         │
│  (实寒)        (三补三泻)                       │
│                                                 │
│  背穴泻脱病    喜穴泻脱病(胃病取中脘)           │
│  补气             肝生脾泻(肝醒)               │
│                血脉气虚等致血症                 │
│                金匮肾气丸(阳中求阴)             │
│                大出血致气虚                     │
│                无华之力(气随血脱)               │
│                阴阴病瘀，阳阳瘀决                │
│                精气乃绝，役不精                 │
│                (1.谁也离不开谁，2.他好我也好)   │
│                                                 │
└─────────────────────────────────────────────────┘`,
    clinicalCases: [
      '案例1：阴盛阳病（实寒证）\n患者：畏寒肢冷、面色苍白、脉沉迟\n病机：阴寒内盛，阳气被遏\n治法：温阳散寒\n方药：白虎汤、六味地黄丸（三补三泻）',

      '案例2：阴虚阳亢（虚热证）\n患者：潮热盗汗、五心烦热、舌红少苔、脉细数\n病机：阴液亏虚，阳气相对亢盛\n治法：滋阴降火\n分析：不该有的有了（热象），该有的没了（阴液）',

      '案例3：大出血致气虚（气随血脱）\n患者：大量出血后→面色苍白、气短乏力、脉微欲绝\n病机：血为阴，气为阳；血脱则气无所依，气随血脱\n治法：益气固脱\n方药：独参汤（急救）\n说明：体现"阴阳互根"，血脱（阴）导致气脱（阳）',

      '案例4：热极生寒（真热假寒）\n患者：高热、面赤、脉数→突然四肢厥冷\n病机：阳盛格阴，阳气内郁不能外达\n治法：清热泻火（治其本）\n辨证要点：虽有四肢冷，但有口渴、脉数、舌红等热象',

      '案例5：阳损及阴\n患者：长期阳虚未治→出现阴虚症状（口干、盗汗）\n病机：阳虚日久，不能化生阴液，导致阴液亏虚\n治法：阳中求阴（金匮肾气丸）\n说明：不能单纯滋阴，需温阳以助化生'
    ],
    keyFormulas: [
      '【对立关系】"阴胜则阳病，阳胜则阴病" —《素问·阴阳应象大论》',
      '【互根关系】"阴在内，阳之守也；阳在外，阴之使也" —《素问·阴阳应象大论》',
      '【消长关系】"阴平阳秘，精神乃治；阴阳离决，精气乃绝" —《素问·生气通天论》',
      '【转化关系】"重阴必阳，重阳必阴" —《素问·阴阳应象大论》',
      '【治疗原则】"善补阳者必于阴中求阳，善补阴者必于阳中求阴" —《类经》',
      '【治疗原则】"壮水之主以制阳光，益火之源以消阴翳" —《素问·至真要大论》'
    ],
    commonMistakes: [
      '❌ 误区1：认为阴阳绝对对立，互不相容',
      '✅ 正确：阴阳是对立统一的整体，相互依存',
      '',
      '❌ 误区2：阴虚就只补阴，阳虚就只补阳',
      '✅ 正确：阴中求阳，阳中求阴（如金匮肾气丸治阴虚用温阳法）',
      '',
      '❌ 误区3：只看表象，不辨真假（如热极生寒时只见四肢冷就用温药）',
      '✅ 正确：辨别真寒假热、真热假寒，治其本质',
      '',
      '❌ 误区4：忽视阴阳的动态平衡',
      '✅ 正确：阴平阳秘才是健康，需要维持动态平衡',
      '',
      '❌ 误区5：大出血后只注重补血',
      '✅ 正确：气随血脱，需先益气固脱（独参汤）',
      '',
      '💡 考试重点：',
      '1. 阴阳互根：谁也离不开谁；他好我也好',
      '2. 气随血脱：大出血致气虚，体现阴损及阳',
      '3. 真热假寒 vs 真寒假热：看本质而非表象',
      '4. 阴中求阳：如金匮肾气丸（阳中求阴）'
    ],
    imageReference: '/knowledges/阴阳五行气血津液.jpg'
  }

  if (yinYangIndex !== -1) {
    // 更新现有的阴阳学说
    keyPoints[yinYangIndex] = enhancedYinYangTheory
    console.log('✅ 找到现有阴阳学说知识点，正在更新...')
  } else {
    // 如果不存在，添加到第一位
    keyPoints.unshift(enhancedYinYangTheory)
    console.log('✅ 添加新的阴阳学说知识点到第一位...')
  }

  // 更新数据库
  await prisma.category.update({
    where: { id: category.id },
    data: {
      keyPoints: JSON.stringify(keyPoints)
    }
  })

  console.log('\n✅ 成功更新阴阳学说知识点！')
  console.log('\n新增内容包括：')
  console.log('  📖 详细的四大关系讲解（对立、互根、消长、转化）')
  console.log('  📊 阴阳失调临床表现对照表')
  console.log('  🏥 5个完整临床案例（含病机分析）')
  console.log('  🔑 6条经典原文公式')
  console.log('  ⚠️ 5大常见误区与正确理解')
  console.log('  🖼️ 参考图片链接')
  console.log(`\n当前该分类共有 ${keyPoints.length} 个知识点`)
}

updateYinYangTheory()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
