import { PrismaClient } from '@prisma/client'

const prisma = new PrismaClient()

async function addYinYangTheory() {
  console.log('添加阴阳学说知识点...\n')

  // 查找Domain 1分类
  const category = await prisma.category.findFirst({
    where: { code: 'DOMAIN_1_ASSESSMENT' }
  })

  if (!category) {
    console.log('❌ 未找到Domain 1分类')
    return
  }

  // 解析现有知识点
  let keyPoints = []
  if (category.keyPoints) {
    try {
      keyPoints = JSON.parse(category.keyPoints)
    } catch (e) {
      console.log('❌ 解析现有知识点失败')
      return
    }
  }

  // 检查是否已存在阴阳学说
  const existingIndex = keyPoints.findIndex((p: any) => p.title?.includes('阴阳'))
  if (existingIndex !== -1) {
    console.log('发现已存在的阴阳相关知识点，将进行增强...')
    // 移除旧的，我们将添加新的更详细的版本
    keyPoints.splice(existingIndex, 1)
  }

  // 创建详细的阴阳学说知识点
  const yinYangTheory = {
    title: '阴阳学说',
    description: '阴阳学说是中医理论的哲学基础，认为宇宙万物都可归纳为阴阳两个对立统一的属性。阴阳之间相互依存、相互制约、相互转化，维持着动态平衡。在人体，阴阳平衡代表健康，阴阳失调导致疾病。',
    examples: [
      '阴阳属性：天为阳、地为阴；日为阳、月为阴；火为阳、水为阴',
      '人体阴阳：上部为阳、下部为阴；体表为阳、内脏为阴；气为阳、血为阴',
      '脏腑阴阳：心肺脾肝肾为阴（五脏），胃肠膀胱胆为阳（六腑）',
      '疾病阴阳：热证为阳、寒证为阴；实证为阳、虚证为阴',
      '治疗原则：阳虚补阳、阴虚补阴；阳盛清热、阴盛温散'
    ],
    detailedExplanation: `阴阳学说的核心内容：

一、阴阳的基本概念
• 阴：沉降、寒凉、抑制、物质、静止、内守
• 阳：上升、温热、兴奋、功能、运动、外向

二、阴阳的基本关系
1. 对立制约
   - 阴阳相互对立、相互制约
   - 阴制约阳，阳制约阴
   - 如：寒与热、静与动

2. 互根互用
   - 阴阳相互依存，不可分离
   - "孤阴不生，独阳不长"
   - 阴为阳之基，阳为阴之用

3. 消长平衡
   - 阴消阳长、阳消阴长
   - 维持动态平衡
   - 失衡导致疾病

4. 相互转化
   - 阴极转阳、阳极转阴
   - 寒极生热、热极生寒
   - 量变积累到质变

三、阴阳在人体的应用
部位：上为阳、下为阴；外为阳、内为阴；背为阳、腹为阴
组织：气为阳、血为阴；脏为阴、腑为阳
功能：兴奋为阳、抑制为阴；温升为阳、凉降为阴`,
    visualDiagram: `
┌─────────────────────────────────────┐
│          阴阳关系图                 │
├─────────────────────────────────────┤
│                                     │
│        阴 ←──对立制约──→ 阳         │
│         ↑                ↑          │
│         │  互根互用      │          │
│         ↓                ↓          │
│        物质            功能          │
│        安静            躁动          │
│        寒凉            温热          │
│        抑制            兴奋          │
│        内守            外向          │
│                                     │
│    消长平衡示意：                   │
│    ━━━━━━━━━━━━━━━━━               │
│    阴 ████░░░░ 阳  （阴盛阳虚）     │
│    阴 ░░░░████ 阳  （阳盛阴虚）     │
│    阴 ████████ 阳  （阴阳平衡）     │
│                                     │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│       人体阴阳分布图                │
├─────────────────────────────────────┤
│                                     │
│         头部（阳）                  │
│         ╱────╲                      │
│        ▕ 背阳 ▏                     │
│    阳侧│ 脊柱 │阳侧                 │
│        ▕ 腹阴 ▏                     │
│         ╲────╱                      │
│      下肢（阴）                     │
│                                     │
│    五脏（阴）：心肝脾肺肾           │
│    六腑（阳）：胃肠胆膀胱三焦       │
│                                     │
│    气（阳）───→ 推动、温煦          │
│    血（阴）───→ 濡养、滋润          │
│                                     │
└─────────────────────────────────────┘`,
    clinicalCases: [
      '案例1：患者发热（阳盛）、口渴喜冷饮、脉洪数 → 诊断：阳热亢盛 → 治法：清热泻火（寒凉药物以制约阳热）',
      '案例2：患者畏寒（阴盛）、四肢冰冷、脉沉迟 → 诊断：阴寒内盛 → 治法：温阳散寒（温热药物以制约阴寒）',
      '案例3：患者潮热盗汗（阴虚阳亢）、五心烦热、舌红少苔 → 诊断：阴虚火旺 → 治法：滋阴降火（补阴以制阳）',
      '案例4：患者疲乏无力（阳虚）、面色苍白、畏寒肢冷 → 诊断：阳气不足 → 治法：温补阳气（补阳以生阴）'
    ],
    keyFormulas: [
      '阴阳对立："阴阳者，天地之道也，万物之纲纪"',
      '阴阳互根："阴在内，阳之守也；阳在外，阴之使也"',
      '阴阳转化："重阴必阳，重阳必阴"',
      '治疗原则："阳病治阴，阴病治阳" "壮水之主以制阳光，益火之源以消阴翳"'
    ],
    commonMistakes: [
      '❌ 认为阴阳是绝对对立、互不相容',
      '❌ 忽视阴阳的相互依存关系',
      '❌ 只看到阴阳的静态划分，忽视动态平衡',
      '❌ 治疗时只注重补虚，不注重泻实',
      '✅ 阴阳是对立统一的整体',
      '✅ 治疗需要"阴中求阳，阳中求阴"',
      '✅ 掌握"阴平阳秘，精神乃治"的平衡观',
      '✅ 理解"善补阳者必于阴中求阳，善补阴者必于阳中求阴"'
    ]
  }

  // 将阴阳学说插入到第一个位置（作为基础理论）
  keyPoints.unshift(yinYangTheory)

  // 更新数据库
  await prisma.category.update({
    where: { id: category.id },
    data: {
      keyPoints: JSON.stringify(keyPoints)
    }
  })

  console.log('✅ 成功添加阴阳学说知识点到 Domain 1: 評估病人')
  console.log(`   - 位置：第一个知识点（基础理论）`)
  console.log(`   - 包含：详细解释、可视化图表、临床案例、关键公式、常见错误`)
  console.log(`   - 现在该分类共有 ${keyPoints.length} 个知识点`)
}

addYinYangTheory()
  .catch(console.error)
  .finally(() => prisma.$disconnect())
