# Phase 4: ç®¡ç†å‘˜ç³»ç»Ÿ - å®æ–½è®¡åˆ’

## ç›®æ ‡
æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç®¡ç†å‘˜åå°ç³»ç»Ÿï¼Œç”¨äºç®¡ç†ç”¨æˆ·ã€é¢˜ç›®ã€è€ƒè¯•é…ç½®å’Œç³»ç»Ÿç›‘æ§ã€‚

---

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

### 1. ç®¡ç†å‘˜è®¤è¯å’Œæƒé™ (Priority: High)
- [ ] åœ¨ User model ä¸­æ·»åŠ  `role` å­—æ®µï¼ˆuser, adminï¼‰
- [ ] æ•°æ®åº“è¿ç§»ï¼šæ·»åŠ  role å­—æ®µ
- [ ] åˆ›å»º `requireAdmin()` ä¸­é—´ä»¶
- [ ] åˆ›å»ºç®¡ç†å‘˜ç™»å½•é¡µé¢
- [ ] ä¿®æ”¹ authStore æ”¯æŒ role ä¿¡æ¯

### 2. ç®¡ç†å‘˜å¯¼èˆªå’Œå¸ƒå±€ (Priority: High)
- [ ] åˆ›å»ºç®¡ç†å‘˜å¸ƒå±€ç»„ä»¶ `layouts/admin.vue`
- [ ] åˆ›å»ºç®¡ç†å‘˜ä¾§è¾¹æ å¯¼èˆª
- [ ] åˆ›å»ºç®¡ç†å‘˜é¡¶éƒ¨å¯¼èˆªæ 
- [ ] æ·»åŠ æƒé™æ£€æŸ¥ï¼ˆéç®¡ç†å‘˜é‡å®šå‘ï¼‰

### 3. ç”¨æˆ·ç®¡ç† (Priority: High)
- [ ] ç”¨æˆ·åˆ—è¡¨é¡µé¢ `/admin/users`
- [ ] ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹
- [ ] ç”¨æˆ·è®¢é˜…ç®¡ç†ï¼ˆæ·»åŠ /ç§»é™¤è€ƒè¯•è®¢é˜…ï¼‰
- [ ] ç”¨æˆ·çŠ¶æ€ç®¡ç†ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰
- [ ] ç”¨æˆ·ç»Ÿè®¡æŸ¥çœ‹
- [ ] API: GET /api/admin/users - è·å–ç”¨æˆ·åˆ—è¡¨
- [ ] API: GET /api/admin/users/:id - è·å–ç”¨æˆ·è¯¦æƒ…
- [ ] API: PUT /api/admin/users/:id - æ›´æ–°ç”¨æˆ·ä¿¡æ¯
- [ ] API: POST /api/admin/users/:id/subscriptions - ç®¡ç†è®¢é˜…

### 4. é¢˜ç›®ç®¡ç† (Priority: High)
- [ ] é¢˜ç›®åˆ—è¡¨é¡µé¢ `/admin/questions`
- [ ] é¢˜ç›®åˆ›å»ºé¡µé¢
- [ ] é¢˜ç›®ç¼–è¾‘é¡µé¢
- [ ] é¢˜ç›®åˆ é™¤åŠŸèƒ½
- [ ] æ‰¹é‡å¯¼å…¥é¢˜ç›®ï¼ˆCSV/JSONï¼‰
- [ ] é¢˜ç›®åˆ†ç±»ç®¡ç†
- [ ] API: GET /api/admin/questions - è·å–é¢˜ç›®åˆ—è¡¨
- [ ] API: POST /api/admin/questions - åˆ›å»ºé¢˜ç›®
- [ ] API: PUT /api/admin/questions/:id - æ›´æ–°é¢˜ç›®
- [ ] API: DELETE /api/admin/questions/:id - åˆ é™¤é¢˜ç›®
- [ ] API: POST /api/admin/questions/import - æ‰¹é‡å¯¼å…¥

### 5. åˆ†ç±»ç®¡ç† (Priority: Medium)
- [ ] åˆ†ç±»åˆ—è¡¨é¡µé¢ `/admin/categories`
- [ ] åˆ†ç±»åˆ›å»º/ç¼–è¾‘
- [ ] åˆ†ç±»åˆ é™¤ï¼ˆæ£€æŸ¥æ˜¯å¦æœ‰å…³è”é¢˜ç›®ï¼‰
- [ ] API: GET /api/admin/categories - è·å–åˆ†ç±»åˆ—è¡¨
- [ ] API: POST /api/admin/categories - åˆ›å»ºåˆ†ç±»
- [ ] API: PUT /api/admin/categories/:id - æ›´æ–°åˆ†ç±»
- [ ] API: DELETE /api/admin/categories/:id - åˆ é™¤åˆ†ç±»

### 6. ç³»ç»Ÿä»ªè¡¨ç›˜ (Priority: Medium)
- [ ] ç®¡ç†å‘˜é¦–é¡µ `/admin/dashboard`
- [ ] æ€»ä½“ç»Ÿè®¡å¡ç‰‡ï¼ˆç”¨æˆ·æ•°ã€é¢˜ç›®æ•°ã€è€ƒè¯•æ•°ï¼‰
- [ ] æœ€è¿‘æ³¨å†Œç”¨æˆ·
- [ ] æœ€æ´»è·ƒç”¨æˆ·
- [ ] é¢˜ç›®ç»Ÿè®¡ï¼ˆæŒ‰è€ƒè¯•ç±»å‹ã€éš¾åº¦ï¼‰
- [ ] ç³»ç»Ÿä½¿ç”¨è¶‹åŠ¿å›¾è¡¨
- [ ] API: GET /api/admin/stats - è·å–ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ®

### 7. è€ƒè¯•é…ç½®ç®¡ç† (Priority: Low)
- [ ] è€ƒè¯•ç±»å‹é…ç½®é¡µé¢
- [ ] è€ƒè¯•å¤§çº²ç¼–è¾‘
- [ ] é¢˜ç›®åˆ†å¸ƒé…ç½®
- [ ] éš¾åº¦æƒé‡é…ç½®

### 8. ç³»ç»Ÿæ—¥å¿—å’Œç›‘æ§ (Priority: Low)
- [ ] ç”¨æˆ·æ´»åŠ¨æ—¥å¿—
- [ ] ç³»ç»Ÿé”™è¯¯æ—¥å¿—
- [ ] API è®¿é—®æ—¥å¿—
- [ ] æ€§èƒ½ç›‘æ§

---

## ğŸ—‚ï¸ æ–‡ä»¶ç»“æ„

```
cale_exam/
â”œâ”€â”€ prisma/
â”‚   â””â”€â”€ schema.prisma (æ·»åŠ  role å­—æ®µ)
â”œâ”€â”€ server/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â”œâ”€â”€ users/
â”‚   â”‚       â”‚   â”œâ”€â”€ index.get.ts (ç”¨æˆ·åˆ—è¡¨)
â”‚   â”‚       â”‚   â”œâ”€â”€ [id].get.ts (ç”¨æˆ·è¯¦æƒ…)
â”‚   â”‚       â”‚   â”œâ”€â”€ [id].put.ts (æ›´æ–°ç”¨æˆ·)
â”‚   â”‚       â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â”‚       â””â”€â”€ subscriptions.post.ts (ç®¡ç†è®¢é˜…)
â”‚   â”‚       â”œâ”€â”€ questions/
â”‚   â”‚       â”‚   â”œâ”€â”€ index.get.ts (é¢˜ç›®åˆ—è¡¨)
â”‚   â”‚       â”‚   â”œâ”€â”€ index.post.ts (åˆ›å»ºé¢˜ç›®)
â”‚   â”‚       â”‚   â”œâ”€â”€ [id].get.ts (é¢˜ç›®è¯¦æƒ…)
â”‚   â”‚       â”‚   â”œâ”€â”€ [id].put.ts (æ›´æ–°é¢˜ç›®)
â”‚   â”‚       â”‚   â”œâ”€â”€ [id].delete.ts (åˆ é™¤é¢˜ç›®)
â”‚   â”‚       â”‚   â””â”€â”€ import.post.ts (æ‰¹é‡å¯¼å…¥)
â”‚   â”‚       â”œâ”€â”€ categories/
â”‚   â”‚       â”‚   â”œâ”€â”€ index.get.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ index.post.ts
â”‚   â”‚       â”‚   â”œâ”€â”€ [id].put.ts
â”‚   â”‚       â”‚   â””â”€â”€ [id].delete.ts
â”‚   â”‚       â””â”€â”€ stats.get.ts (ç®¡ç†å‘˜ç»Ÿè®¡)
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ admin-helpers.ts (requireAdmin ä¸­é—´ä»¶)
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ admin/
â”‚       â”œâ”€â”€ index.vue (ç®¡ç†å‘˜é¦–é¡µ/ä»ªè¡¨ç›˜)
â”‚       â”œâ”€â”€ users/
â”‚       â”‚   â”œâ”€â”€ index.vue (ç”¨æˆ·åˆ—è¡¨)
â”‚       â”‚   â””â”€â”€ [id].vue (ç”¨æˆ·è¯¦æƒ…)
â”‚       â”œâ”€â”€ questions/
â”‚       â”‚   â”œâ”€â”€ index.vue (é¢˜ç›®åˆ—è¡¨)
â”‚       â”‚   â”œâ”€â”€ create.vue (åˆ›å»ºé¢˜ç›®)
â”‚       â”‚   â””â”€â”€ [id]/
â”‚       â”‚       â””â”€â”€ edit.vue (ç¼–è¾‘é¢˜ç›®)
â”‚       â””â”€â”€ categories/
â”‚           â””â”€â”€ index.vue (åˆ†ç±»ç®¡ç†)
â”œâ”€â”€ layouts/
â”‚   â””â”€â”€ admin.vue (ç®¡ç†å‘˜å¸ƒå±€)
â””â”€â”€ components/
    â””â”€â”€ admin/
        â”œâ”€â”€ Sidebar.vue (ä¾§è¾¹æ )
        â”œâ”€â”€ TopNav.vue (é¡¶éƒ¨å¯¼èˆª)
        â”œâ”€â”€ UserTable.vue (ç”¨æˆ·è¡¨æ ¼)
        â”œâ”€â”€ QuestionTable.vue (é¢˜ç›®è¡¨æ ¼)
        â”œâ”€â”€ QuestionForm.vue (é¢˜ç›®è¡¨å•)
        â””â”€â”€ StatsCard.vue (ç»Ÿè®¡å¡ç‰‡)
```

---

## ğŸ¨ UI/UX è®¾è®¡

### é…è‰²æ–¹æ¡ˆ
- **ä¸»è‰²**: æ·±è“è‰² (#1e40af) - ä¸“ä¸šã€æƒå¨
- **æ¬¡è‰²**: ç´«è‰² (#7c3aed) - åˆ›æ–°ã€ç°ä»£
- **æˆåŠŸ**: ç»¿è‰² (#059669)
- **è­¦å‘Š**: æ©™è‰² (#ea580c)
- **é”™è¯¯**: çº¢è‰² (#dc2626)

### å¸ƒå±€ç»“æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é¡¶éƒ¨å¯¼èˆªæ  (Logo, æœç´¢, ç”¨æˆ·èœå•)      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚      â”‚                                  â”‚
â”‚ ä¾§   â”‚  ä¸»å†…å®¹åŒº                         â”‚
â”‚ è¾¹   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚ æ    â”‚  â”‚  é¢åŒ…å±‘å¯¼èˆª                 â”‚  â”‚
â”‚      â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚ ä»ª   â”‚  â”‚                            â”‚  â”‚
â”‚ è¡¨   â”‚  â”‚  é¡µé¢å†…å®¹                   â”‚  â”‚
â”‚ ç›˜   â”‚  â”‚                            â”‚  â”‚
â”‚ ç”¨   â”‚  â”‚                            â”‚  â”‚
â”‚ æˆ·   â”‚  â”‚                            â”‚  â”‚
â”‚ é¢˜   â”‚  â”‚                            â”‚  â”‚
â”‚ ç›®   â”‚  â”‚                            â”‚  â”‚
â”‚ ...  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â”‚                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” æƒé™ç³»ç»Ÿè®¾è®¡

### Role æšä¸¾
- `USER`: æ™®é€šç”¨æˆ·
- `ADMIN`: ç®¡ç†å‘˜

### æƒé™æ£€æŸ¥æµç¨‹
```typescript
// åç«¯ä¸­é—´ä»¶
export function requireAdmin(event: H3Event) {
  const currentUser = requireAuth(event)

  if (currentUser.role !== 'ADMIN') {
    throw createError({
      statusCode: 403,
      message: 'Forbidden: Admin access required'
    })
  }

  return currentUser
}

// å‰ç«¯è·¯ç”±å®ˆå«
middleware/admin.ts
export default defineNuxtRouteMiddleware((to, from) => {
  const authStore = useAuthStore()

  if (!authStore.isAdmin) {
    return navigateTo('/')
  }
})
```

---

## ğŸ“Š æ•°æ®åº“å˜æ›´

### User Model æ›´æ–°
```prisma
model User {
  id                String   @id @default(uuid())
  email             String   @unique
  username          String   @unique
  password          String
  role              Role     @default(USER)  // æ–°å¢
  subscribedExams   String[] // ä¿æŒä¸å˜
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // å…³ç³»ä¿æŒä¸å˜
  studyPlans        StudyPlan[]
  exams             Exam[]
  userAnswers       UserAnswer[]
  wrongQuestions    WrongQuestion[]
}

enum Role {
  USER
  ADMIN
}
```

---

## ğŸ”„ å®æ–½é¡ºåº

### Sprint 1: åŸºç¡€æ¶æ„ (æ ¸å¿ƒ)
1. âœ… æ•°æ®åº“è¿ç§» - æ·»åŠ  role å­—æ®µ
2. âœ… åˆ›å»º requireAdmin ä¸­é—´ä»¶
3. âœ… åˆ›å»ºç®¡ç†å‘˜å¸ƒå±€
4. âœ… åˆ›å»ºç®¡ç†å‘˜ä»ªè¡¨ç›˜é¦–é¡µ
5. âœ… æ›´æ–° authStore æ”¯æŒ role

### Sprint 2: ç”¨æˆ·ç®¡ç† (é«˜ä¼˜å…ˆçº§)
1. âœ… ç”¨æˆ·åˆ—è¡¨ API
2. âœ… ç”¨æˆ·åˆ—è¡¨é¡µé¢
3. âœ… ç”¨æˆ·è¯¦æƒ… API
4. âœ… ç”¨æˆ·è¯¦æƒ…é¡µé¢
5. âœ… è®¢é˜…ç®¡ç†åŠŸèƒ½

### Sprint 3: é¢˜ç›®ç®¡ç† (é«˜ä¼˜å…ˆçº§)
1. âœ… é¢˜ç›®åˆ—è¡¨ API
2. âœ… é¢˜ç›®åˆ—è¡¨é¡µé¢
3. âœ… é¢˜ç›®åˆ›å»º API + é¡µé¢
4. âœ… é¢˜ç›®ç¼–è¾‘ API + é¡µé¢
5. âœ… é¢˜ç›®åˆ é™¤ API

### Sprint 4: é«˜çº§åŠŸèƒ½ (ä¸­ä¼˜å…ˆçº§)
1. âœ… æ‰¹é‡å¯¼å…¥é¢˜ç›®
2. âœ… åˆ†ç±»ç®¡ç†
3. âœ… ç»Ÿè®¡å›¾è¡¨
4. âœ… æœç´¢å’Œè¿‡æ»¤

---

## ğŸ“ API ç«¯ç‚¹è®¾è®¡

### ç”¨æˆ·ç®¡ç† APIs
| Method | Endpoint | Description | Auth |
|--------|----------|-------------|------|
| GET | /api/admin/users | è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆåˆ†é¡µã€æœç´¢ï¼‰ | Admin |
| GET | /api/admin/users/:id | è·å–ç”¨æˆ·è¯¦æƒ… | Admin |
| PUT | /api/admin/users/:id | æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | Admin |
| POST | /api/admin/users/:id/subscriptions | ç®¡ç†ç”¨æˆ·è®¢é˜… | Admin |
| PUT | /api/admin/users/:id/status | å¯ç”¨/ç¦ç”¨ç”¨æˆ· | Admin |

### é¢˜ç›®ç®¡ç† APIs
| Method | Endpoint | Description | Auth |
|--------|----------|-------------|------|
| GET | /api/admin/questions | è·å–é¢˜ç›®åˆ—è¡¨ | Admin |
| GET | /api/admin/questions/:id | è·å–é¢˜ç›®è¯¦æƒ… | Admin |
| POST | /api/admin/questions | åˆ›å»ºé¢˜ç›® | Admin |
| PUT | /api/admin/questions/:id | æ›´æ–°é¢˜ç›® | Admin |
| DELETE | /api/admin/questions/:id | åˆ é™¤é¢˜ç›® | Admin |
| POST | /api/admin/questions/import | æ‰¹é‡å¯¼å…¥é¢˜ç›® | Admin |

### åˆ†ç±»ç®¡ç† APIs
| Method | Endpoint | Description | Auth |
|--------|----------|-------------|------|
| GET | /api/admin/categories | è·å–åˆ†ç±»åˆ—è¡¨ | Admin |
| POST | /api/admin/categories | åˆ›å»ºåˆ†ç±» | Admin |
| PUT | /api/admin/categories/:id | æ›´æ–°åˆ†ç±» | Admin |
| DELETE | /api/admin/categories/:id | åˆ é™¤åˆ†ç±» | Admin |

### ç»Ÿè®¡ APIs
| Method | Endpoint | Description | Auth |
|--------|----------|-------------|------|
| GET | /api/admin/stats | è·å–ç®¡ç†å‘˜ç»Ÿè®¡æ•°æ® | Admin |

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

Phase 4 å®Œæˆæ ‡å‡†ï¼š
- [ ] ç®¡ç†å‘˜å¯ä»¥ç™»å½•å¹¶è®¿é—®ç®¡ç†åå°
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å’Œç®¡ç†æ‰€æœ‰ç”¨æˆ·
- [ ] ç®¡ç†å‘˜å¯ä»¥ä¸ºç”¨æˆ·æ·»åŠ /ç§»é™¤è€ƒè¯•è®¢é˜…
- [ ] ç®¡ç†å‘˜å¯ä»¥åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤é¢˜ç›®
- [ ] ç®¡ç†å‘˜å¯ä»¥æ‰¹é‡å¯¼å…¥é¢˜ç›®
- [ ] ç®¡ç†å‘˜å¯ä»¥ç®¡ç†åˆ†ç±»
- [ ] ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹ç³»ç»Ÿç»Ÿè®¡æ•°æ®
- [ ] æ‰€æœ‰ç®¡ç†å‘˜åŠŸèƒ½éƒ½æœ‰æƒé™ä¿æŠ¤
- [ ] UI ç¾è§‚ã€å“åº”å¼ã€æ˜“ç”¨

---

## ğŸ“¦ æŠ€æœ¯æ ˆ

- **å‰ç«¯**: Nuxt 3 + Vue 3 + TypeScript + Tailwind CSS
- **åç«¯**: Nuxt Server API + Prisma
- **è®¤è¯**: JWT (å¤ç”¨ç°æœ‰ç³»ç»Ÿ)
- **æƒé™**: Role-based access control (RBAC)
- **UIç»„ä»¶**: Headless UI / Radix Vue (å¯é€‰)
- **å›¾è¡¨**: Chart.js / ECharts (å¯é€‰)

---

**Phase 4 å¼€å§‹æ—¶é—´**: 2025-10-20
**é¢„è®¡å®Œæˆæ—¶é—´**: TBD
**å½“å‰çŠ¶æ€**: Planning âœï¸
