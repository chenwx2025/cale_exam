# ✅ 部署前检查清单

在部署到生产环境之前，请确保完成以下所有检查项。

---

## 🔒 安全检查

### 环境变量和密钥
- [ ] 已创建 `.env.production` 文件
- [ ] `JWT_SECRET` 使用了强随机密钥（至少32位）
  ```bash
  # 生成方法:
  node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
  ```
- [ ] `ADMIN_PASSWORD` 已修改为强密码
- [ ] `DATABASE_URL` 已配置正确
- [ ] 所有敏感信息未提交到 Git
- [ ] 已验证 `.env.production` 在 `.gitignore` 中

### 数据库安全
- [ ] 数据库密码足够强（至少12位，包含大小写、数字、特殊字符）
- [ ] 数据库仅允许应用服务器访问（防火墙配置）
- [ ] 使用 PostgreSQL 而非 SQLite（生产环境推荐）

### 应用安全
- [ ] CORS 配置正确（仅允许信任的域名）
- [ ] 文件上传大小限制已设置
- [ ] 敏感 API 端点需要认证
- [ ] 已移除所有调试代码和 console.log

---

## 🗄️ 数据库检查

### 数据完整性
- [ ] 已备份当前数据库
- [ ] 已测试数据库迁移脚本
- [ ] 生产数据库连接测试成功
- [ ] Prisma schema 与生产数据库一致

### 数据迁移
- [ ] 了解如何从 SQLite 迁移到 PostgreSQL（如需要）
- [ ] 已准备好数据迁移计划
- [ ] 已测试数据导入/导出流程

---

## 🏗️ 应用检查

### 构建测试
- [ ] 本地成功运行 `npm run build`
- [ ] 构建产物大小合理（检查 `.output` 目录）
- [ ] 所有依赖都在 `package.json` 中正确声明
- [ ] TypeScript 类型检查通过

### 功能测试
- [ ] 用户注册/登录功能正常
- [ ] 考试创建和答题功能正常
- [ ] 管理后台功能正常
- [ ] 数据导入/导出功能正常
- [ ] 邮件通知功能正常（如启用）
- [ ] Web Push 通知功能正常（如启用）

### 性能测试
- [ ] 页面加载速度可接受（< 3秒）
- [ ] 数据库查询性能优化
- [ ] 大量数据下的性能表现
- [ ] 移动端性能测试

---

## 🌐 基础设施检查

### 服务器准备
- [ ] 服务器规格满足需求（最低 512MB RAM）
- [ ] Node.js 18+ 已安装
- [ ] 数据库服务器已准备
- [ ] 存储空间充足（至少 1GB 可用）
- [ ] 防火墙规则已配置

### 域名和 SSL
- [ ] 域名已注册
- [ ] DNS 记录已配置
- [ ] SSL 证书已准备或计划使用 Let's Encrypt
- [ ] HTTPS 重定向已配置

### 监控和日志
- [ ] 日志系统已配置
- [ ] 错误追踪已设置（如 Sentry）
- [ ] 性能监控已设置
- [ ] 备份策略已制定

---

## 📦 部署准备

### 代码准备
- [ ] 所有代码已提交到 Git
- [ ] 已创建生产分支（如需要）
- [ ] 版本号已更新
- [ ] CHANGELOG 已更新

### 文档准备
- [ ] README.md 已更新
- [ ] 部署文档已准备（DEPLOYMENT_GUIDE.md）
- [ ] 用户手册已准备
- [ ] API 文档已更新

### 部署工具
根据你选择的部署方式，检查相应工具：

#### Vercel 部署
- [ ] Vercel 账号已创建
- [ ] GitHub 仓库已连接
- [ ] 环境变量已在 Vercel 配置

#### Docker 部署
- [ ] Docker 和 Docker Compose 已安装
- [ ] `Dockerfile` 测试通过
- [ ] `docker-compose.yml` 配置正确
- [ ] Docker 镜像构建成功

#### VPS 部署
- [ ] PM2 已安装并配置
- [ ] Nginx 配置已准备
- [ ] `ecosystem.config.js` 已配置
- [ ] 部署脚本已测试

---

## 🧪 测试检查

### 单元测试
- [ ] 关键功能有单元测试覆盖
- [ ] 所有测试通过

### 集成测试
- [ ] API 端点测试通过
- [ ] 数据库操作测试通过

### E2E 测试
- [ ] 用户流程测试通过
- [ ] 跨浏览器测试通过
- [ ] 移动端测试通过

---

## 🔄 回滚计划

### 准备回滚
- [ ] 了解如何快速回滚到上一个版本
- [ ] 数据库回滚策略已准备
- [ ] 已准备回滚脚本或流程

### 紧急联系
- [ ] 技术团队联系方式已确认
- [ ] 服务商支持渠道已知晓
- [ ] 应急响应流程已建立

---

## 📱 用户通知

### 部署通知
- [ ] 用户已被告知即将维护（如需停机）
- [ ] 维护时间窗口已选择（低峰时段）
- [ ] 通知渠道已准备（邮件、公告等）

---

## 🎯 部署日计划

### 部署前（1小时前）
- [ ] 再次备份所有数据
- [ ] 通知用户即将开始维护
- [ ] 准备好所有部署命令
- [ ] 团队成员就位

### 部署中
- [ ] 执行部署脚本
- [ ] 实时监控部署状态
- [ ] 记录所有操作和异常

### 部署后
- [ ] 验证所有功能正常
- [ ] 检查日志无错误
- [ ] 性能监控正常
- [ ] 通知用户服务已恢复
- [ ] 持续监控24小时

---

## ✅ 最终检查

在执行部署命令前，最后确认：

- [ ] 我已经完成上述所有检查项
- [ ] 我有完整的数据备份
- [ ] 我知道如何回滚
- [ ] 我已准备好应对可能的问题
- [ ] 团队已准备就绪

---

## 🚀 准备好了？开始部署！

选择你的部署方式：

### Vercel（推荐新手）
```bash
vercel --prod
```

### Docker
```bash
docker-compose up -d
docker-compose exec app npx prisma db push
```

### VPS
```bash
./scripts/deploy.sh production
```

---

## 📞 遇到问题？

### 常见问题解决
1. 查看日志文件
2. 检查环境变量
3. 验证数据库连接
4. 查看完整文档: DEPLOYMENT_GUIDE.md

### 获取帮助
- GitHub Issues
- 技术支持团队
- 社区论坛

---

祝你部署顺利！🎉

记住：**第一次部署总是最难的，但之后就会越来越简单。**
