version: 1
frontend:
  phases:
    preBuild:
      commands:
        # 设置 Node.js 版本
        - nvm install 22
        - nvm use 22
        - node --version
        - npm --version
        # 安装依赖（包含 devDependencies）
        - npm install --legacy-peer-deps
        # 生成 Prisma Client（连接到现有 PostgreSQL 数据库）
        - npx prisma generate
    build:
      commands:
        - npm run build
  artifacts:
    # Nuxt 3 输出目录
    baseDirectory: .output/public
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .nuxt/**/*
  customHeaders:
    # 安全头部
    - pattern: '**/*'
      headers:
        - key: 'Strict-Transport-Security'
          value: 'max-age=31536000; includeSubDomains'
        - key: 'X-Frame-Options'
          value: 'SAMEORIGIN'
        - key: 'X-Content-Type-Options'
          value: 'nosniff'
        - key: 'X-XSS-Protection'
          value: '1; mode=block'
        - key: 'Referrer-Policy'
          value: 'strict-origin-when-cross-origin'
    # API 路由缓存控制
    - pattern: '/api/**'
      headers:
        - key: 'Cache-Control'
          value: 'no-cache, no-store, must-revalidate'
