# 管理后台密码保护

## 功能说明

管理后台现在需要密码验证才能访问，提供了一个简洁优雅的登录界面。

## 设计特点

### UI 设计
- **现代化设计**：使用渐变背景和圆角卡片
- **响应式布局**：适配各种屏幕尺寸
- **交互友好**：
  - 密码可见/隐藏切换
  - 加载状态提示
  - 错误提示动画
  - 输入框抖动效果

### 安全特性
- 密码存储在环境变量中
- 本地认证状态保持（24小时有效）
- 密码错误时清空输入
- 防止暴力破解（错误提示）

## 配置方法

### 1. 设置密码

在 `.env` 文件中设置管理员密码：

```env
ADMIN_PASSWORD="your-secure-password"
```

**默认密码**：`admin123`（建议修改）

### 2. 修改密码

编辑 `.env` 文件，修改 `ADMIN_PASSWORD` 的值：

```env
ADMIN_PASSWORD="new-password-123"
```

### 3. 生产环境配置

在生产环境中，建议：
1. 使用强密码（至少12位，包含大小写字母、数字和特殊字符）
2. 定期更换密码
3. 不要将密码提交到代码仓库

## 使用方法

### 访问管理后台

1. 访问 `/admin` 页面
2. 系统会显示密码输入界面
3. 输入正确的密码
4. 点击"访问管理后台"按钮
5. 验证成功后，可以使用管理功能

### 登录状态

- 登录成功后，状态会保存在浏览器的 `localStorage` 中
- 有效期为 **24小时**
- 24小时后需要重新输入密码
- 清除浏览器数据会清除登录状态

### 退出登录

如需退出登录，可以：
1. 清除浏览器的 `localStorage`
2. 或等待24小时后自动过期

## 技术实现

### 组件结构

```
components/AdminAuth.vue         # 密码验证组件
server/api/admin/auth.post.ts   # 密码验证API
pages/admin.vue                  # 管理后台页面（集成密码保护）
```

### 工作流程

1. **首次访问**：
   - 显示密码输入界面
   - 用户输入密码
   - 前端发送密码到后端API

2. **密码验证**：
   - 后端对比环境变量中的密码
   - 验证成功返回 success
   - 验证失败返回 401 错误

3. **状态保存**：
   - 验证成功后，保存认证信息到 localStorage
   - 包含时间戳，用于检查有效期

4. **后续访问**：
   - 检查 localStorage 中的认证状态
   - 如果在24小时内，直接显示管理界面
   - 如果已过期，重新显示密码输入界面

## UI 特性

### 视觉效果
- 渐变背景（蓝色到紫色）
- 卡片阴影和圆角
- 蓝色主题按钮
- 平滑过渡动画

### 交互反馈
- **密码可见切换**：点击眼睛图标
- **加载状态**：显示旋转图标和"验证中..."
- **错误提示**：红色边框 + 错误消息 + 抖动动画
- **成功登录**：平滑切换到管理界面

### 无障碍设计
- 适当的标签和 aria 属性
- 键盘导航支持
- 清晰的视觉反馈

## 安全建议

1. **强密码**：使用包含大小写字母、数字和特殊字符的复杂密码
2. **定期更换**：建议每3-6个月更换一次密码
3. **环境隔离**：开发、测试、生产环境使用不同的密码
4. **不要共享**：不要在代码、文档或通讯工具中分享密码
5. **HTTPS**：生产环境务必使用 HTTPS 协议

## 示例密码

以下是一些密码强度示例：

- ❌ 弱：`admin123`（默认密码，务必修改）
- ⚠️ 中：`Admin2024!`
- ✅ 强：`Cale@Exam#2024$Secure`
- ✅ 强：`MyS3cur3P@ssw0rd!2024`

## 故障排查

### 问题：密码正确但无法登录
- 检查 `.env` 文件中的 `ADMIN_PASSWORD` 配置
- 确保服务器已重启（修改环境变量后需要重启）

### 问题：24小时后仍然保持登录状态
- 清除浏览器的 localStorage
- 检查浏览器时间设置是否正确

### 问题：忘记密码
- 检查 `.env` 文件中的 `ADMIN_PASSWORD` 值
- 如果无法访问，可以修改该值并重启服务器

## 未来改进

可能的功能扩展：

1. **多用户支持**：支持多个管理员账号
2. **权限管理**：不同用户不同权限
3. **登录日志**：记录登录历史和IP地址
4. **两步验证**：增加额外的安全层
5. **密码重置**：邮件或手机验证码重置密码
6. **会话管理**：在线用户列表和强制下线

## 相关文件

- [AdminAuth.vue](../components/AdminAuth.vue) - 密码验证组件
- [auth.post.ts](../server/api/admin/auth.post.ts) - 验证API
- [admin.vue](../pages/admin.vue) - 管理后台页面
- [.env.example](../.env.example) - 环境变量示例
