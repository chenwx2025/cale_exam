# 学习小组打卡功能重新设计文档

## 一、设计理念

### 核心原则
- **简化操作**：一键打卡，无需填写任何信息
- **激励可视化**：通过视觉元素强化成就感和坚持动力
- **社交互动**：展示小组成员的打卡情况，营造学习氛围

### 用户体验目标
1. 用户进入打卡页面后，能立即了解自己的打卡状态
2. 一键完成打卡，操作简单快捷
3. 通过连续打卡天数、徽章等激励元素，提升用户粘性
4. 能够看到小组其他成员的打卡情况，形成良性竞争

---

## 二、功能模块设计

### 1. 今日打卡状态区（主要区域）

#### 未打卡状态
```
┌─────────────────────────────────────────┐
│  📅 2025年10月24日 星期五                │
│                                         │
│         ┌─────────────────┐             │
│         │   🔥 打 卡      │             │
│         │                 │             │
│         │  点击完成今日打卡 │             │
│         └─────────────────┘             │
│              (大按钮)                    │
│                                         │
│  💡 今天还未打卡，点击按钮完成打卡       │
└─────────────────────────────────────────┘
```

**UI元素**：
- 日期显示：当前日期 + 星期
- 打卡按钮：大尺寸、醒目、渐变色背景
- 提示文案：友好提醒用户打卡

**交互**：
- 点击打卡按钮 → 调用API → 显示打卡成功动画 → 切换到已打卡状态

---

#### 已打卡状态
```
┌─────────────────────────────────────────┐
│  📅 2025年10月24日 星期五                │
│                                         │
│         ┌─────────────────┐             │
│         │   ✅ 已打卡      │             │
│         │                 │             │
│         │  15:30 完成打卡  │             │
│         └─────────────────┘             │
│                                         │
│  🎉 太棒了！你已完成今日打卡             │
└─────────────────────────────────────────┘
```

**UI元素**：
- 日期显示：当前日期 + 星期
- 已打卡标识：绿色对勾 + "已打卡"文字
- 打卡时间：显示具体打卡时间
- 鼓励文案：正向反馈

---

### 2. 个人统计区

```
┌───────────────────────────────────────────────┐
│  我的打卡统计                                  │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐    │
│  │  🔥 15   │  │  ✓ 78    │  │  📊 89%  │    │
│  │ 连续天数  │  │ 累计天数  │  │  出勤率  │    │
│  └──────────┘  └──────────┘  └──────────┘    │
└───────────────────────────────────────────────┘
```

**数据项**：
1. **连续打卡天数**
   - 图标：🔥 火焰
   - 数字：连续天数
   - 说明：从今天往前数连续打卡的天数
   - 特殊显示：超过7天、30天、100天等里程碑时有特殊样式

2. **累计打卡天数**
   - 图标：✓ 对勾
   - 数字：总打卡天数
   - 说明：加入小组后累计打卡的总天数

3. **打卡出勤率**
   - 图标：📊 图表
   - 数字：百分比
   - 计算：累计打卡天数 / 加入天数 * 100%

---

### 3. 成就徽章区

```
┌───────────────────────────────────────────────┐
│  我的成就徽章                                  │
│  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐          │
│  │ 🏅  │  │ 🎖️  │  │ 👑  │  │ 🔒  │          │
│  │ 7天 │  │ 30天│  │100天│  │365天│          │
│  │已获得│  │已获得│  │ 锁定 │  │ 锁定 │          │
│  └─────┘  └─────┘  └─────┘  └─────┘          │
└───────────────────────────────────────────────┘
```

**徽章类型**：
1. 🏅 **初心者**（连续7天）
2. 🎖️ **坚持者**（连续30天）
3. 👑 **百日冠军**（连续100天）
4. 🔥 **年度传奇**（连续365天）
5. ⭐ **全勤王**（出勤率100%）

**状态**：
- 已获得：彩色图标 + 获得时间
- 未获得（锁定）：灰色图标 + 解锁条件

---

### 4. 本周打卡日历

```
┌───────────────────────────────────────────────┐
│  本周打卡记录                                  │
│  ┌───┬───┬───┬───┬───┬───┬───┐              │
│  │周一│周二│周三│周四│周五│周六│周日│              │
│  ├───┼───┼───┼───┼───┼───┼───┤              │
│  │ ✅│ ✅│ ✅│ ✅│ ✅│   │   │              │
│  │21 │22 │23 │24 │25 │26 │27 │              │
│  └───┴───┴───┴───┴───┴───┴───┘              │
└───────────────────────────────────────────────┘
```

**展示方式**：
- 日期格式：星期 + 日期号
- 已打卡：绿色背景 + ✅
- 未打卡：灰色背景（今天之前）
- 未到时间：白色背景（今天之后）
- 今天：蓝色边框高亮

---

### 5. 小组排行榜

```
┌───────────────────────────────────────────────┐
│  本周小组排行榜（按连续天数）                   │
│  ┌───────────────────────────────────────┐    │
│  │ 🥇 1. 张三          🔥 连续 45 天     │    │
│  ├───────────────────────────────────────┤    │
│  │ 🥈 2. 李四          🔥 连续 30 天     │    │
│  ├───────────────────────────────────────┤    │
│  │ 🥉 3. 王五          🔥 连续 25 天     │    │
│  ├───────────────────────────────────────┤    │
│  │    4. 赵六          🔥 连续 15 天     │    │
│  ├───────────────────────────────────────┤    │
│  │    5. 我（当前用户） 🔥 连续 15 天     │    │
│  └───────────────────────────────────────┘    │
└───────────────────────────────────────────────┘
```

**展示规则**：
- 显示前5名
- 如果当前用户不在前5名，单独显示当前用户的排名
- 前3名显示奖牌图标
- 当前用户高亮显示
- 按连续天数排序

---

### 6. 小组今日打卡动态

```
┌───────────────────────────────────────────────┐
│  今日小组动态                                  │
│  ┌───────────────────────────────────────┐    │
│  │ 👤 张三   刚刚完成打卡   （2分钟前）   │    │
│  ├───────────────────────────────────────┤    │
│  │ 👤 李四   刚刚完成打卡   （10分钟前）  │    │
│  ├───────────────────────────────────────┤    │
│  │ 👤 王五   刚刚完成打卡   （1小时前）   │    │
│  ├───────────────────────────────────────┤    │
│  │ 🎉 今日已有 15 人完成打卡              │    │
│  └───────────────────────────────────────┘    │
└───────────────────────────────────────────────┘
```

**展示内容**：
- 最近5条打卡记录
- 用户头像 + 姓名
- 打卡时间（相对时间）
- 今日小组总打卡人数

---

## 三、完整页面布局

```
┌─────────────────────────────────────────────────┐
│  StudyGroupCheckIn Component                    │
│                                                 │
│  ┌───────────────────────────────────────┐     │
│  │  1. 今日打卡状态区（主区域）           │     │
│  │     - 未打卡：显示打卡按钮             │     │
│  │     - 已打卡：显示已打卡状态           │     │
│  └───────────────────────────────────────┘     │
│                                                 │
│  ┌───────────────────────────────────────┐     │
│  │  2. 个人统计区                        │     │
│  │     连续天数 | 累计天数 | 出勤率      │     │
│  └───────────────────────────────────────┘     │
│                                                 │
│  ┌───────────────────────────────────────┐     │
│  │  3. 成就徽章区                        │     │
│  │     7天 | 30天 | 100天 | 365天        │     │
│  └───────────────────────────────────────┘     │
│                                                 │
│  ┌───────────────────────────────────────┐     │
│  │  4. 本周打卡日历                      │     │
│  │     周一 周二 周三 周四 周五 周六 周日 │     │
│  └───────────────────────────────────────┘     │
│                                                 │
│  ┌──────────────┬────────────────────────┐     │
│  │ 5. 小组排行榜│  6. 今日打卡动态        │     │
│  │              │                        │     │
│  │  前5名用户   │   最近打卡的成员        │     │
│  │  连续天数    │   时间倒序排列          │     │
│  └──────────────┴────────────────────────┘     │
└─────────────────────────────────────────────────┘
```

---

## 四、数据结构设计

### 1. 打卡记录（StudyGroupCheckIn）
```typescript
{
  id: string
  groupId: string
  userId: string
  checkInDate: string        // YYYY-MM-DD
  checkInTime: DateTime      // 新增：具体打卡时间
  createdAt: DateTime
}
```

### 2. API响应数据结构

#### GET `/api/study-groups/:id/check-in`
```typescript
{
  success: true,
  data: {
    todayCheckIn: {
      id: string
      checkInTime: string      // "15:30"
    } | null,

    stats: {
      streakDays: number       // 连续天数
      totalCheckIns: number    // 累计天数
      attendanceRate: number   // 出勤率
      joinedDays: number       // 加入天数
    },

    weeklyCalendar: [
      {
        date: string           // "2025-10-24"
        dayOfWeek: string      // "周一"
        checked: boolean
        isToday: boolean
      }
    ],

    badges: [
      {
        type: string           // "7days", "30days", "100days", "365days"
        unlocked: boolean
        unlockedAt: string | null
      }
    ],

    leaderboard: [
      {
        userId: string
        userName: string
        userAvatar: string
        streakDays: number
        rank: number
        isCurrentUser: boolean
      }
    ],

    recentCheckIns: [
      {
        userId: string
        userName: string
        userAvatar: string
        checkInTime: string    // "2分钟前"
      }
    ],

    groupStats: {
      todayCheckInCount: number  // 今日小组打卡人数
      totalMembers: number       // 小组总人数
    }
  }
}
```

#### POST `/api/study-groups/:id/check-in`
```typescript
// Request body: {} (无需任何参数)

// Response:
{
  success: true,
  data: {
    checkIn: {
      id: string
      checkInDate: string
      checkInTime: string
    },
    newBadges: [              // 本次打卡新获得的徽章
      {
        type: string
        name: string
      }
    ]
  }
}
```

---

## 五、UI设计规范

### 颜色方案

#### 主色调
- **打卡按钮未打卡**：`bg-gradient-to-r from-blue-500 to-indigo-600`
- **已打卡状态**：`bg-gradient-to-r from-green-500 to-emerald-600`
- **连续天数（火焰）**：`text-orange-600 bg-orange-50`
- **累计天数**：`text-blue-600 bg-blue-50`
- **出勤率**：`text-purple-600 bg-purple-50`

#### 状态颜色
- **已打卡日期**：`bg-green-100 border-green-400`
- **未打卡日期**：`bg-gray-100 border-gray-300`
- **今天**：`border-blue-500 border-2`
- **锁定徽章**：`grayscale filter opacity-50`

### 间距规范
- 模块之间：`mb-6`
- 卡片内边距：`p-6`
- 元素间距：`gap-3` 或 `gap-4`

### 字体大小
- 标题：`text-xl font-bold`
- 数字统计：`text-3xl font-bold`
- 普通文字：`text-sm`
- 提示文案：`text-xs text-gray-600`

### 圆角
- 卡片：`rounded-xl`
- 按钮：`rounded-lg`
- 徽章：`rounded-full`

### 阴影
- 卡片：`shadow-md`
- 悬浮效果：`hover:shadow-lg`
- 按钮：`shadow-md hover:shadow-xl`

---

## 六、动画效果

### 1. 打卡成功动画
```
点击打卡按钮
  ↓
按钮缩放动画（scale-95）
  ↓
显示加载状态（旋转图标）
  ↓
成功后：
  - 显示✨庆祝动画
  - 数字增加动画（连续天数+1）
  - 如有新徽章，弹出徽章获得提示
  ↓
切换到已打卡状态
```

**实现**：
- CSS过渡：`transition-all duration-300`
- 数字递增：使用动画库或自定义数字滚动
- 庆祝动画：使用lottie或CSS动画

### 2. 徽章解锁动画
```
获得新徽章时：
  1. 屏幕中央弹出模态框
  2. 徽章从小到大放大（scale动画）
  3. 光芒四射效果
  4. 显示徽章名称和恭喜文案
  5. 3秒后自动关闭
```

### 3. 日历打卡标记动画
```
今日打卡后：
  - 日历格子从灰色渐变到绿色
  - 出现✅对勾，从小到大
  - 轻微弹跳效果
```

---

## 七、响应式设计

### 移动端（< 768px）
- 统计卡片：单列布局
- 排行榜和动态：堆叠显示
- 打卡按钮：全宽显示
- 日历：缩小字体，保持7列

### 平板端（768px - 1024px）
- 统计卡片：2列布局
- 排行榜和动态：并排显示

### 桌面端（> 1024px）
- 统计卡片：3列布局
- 所有模块按设计稿展示

---

## 八、实现优先级

### P0（第一阶段 - 核心功能）
1. ✅ 今日打卡状态区
   - 未打卡显示打卡按钮
   - 已打卡显示状态和时间
   - 一键打卡功能

2. ✅ 个人统计区
   - 连续天数
   - 累计天数
   - 出勤率

### P1（第二阶段 - 增强功能）
3. ✅ 本周打卡日历
4. ✅ 小组排行榜（前5名）

### P2（第三阶段 - 社交功能）
5. ✅ 今日打卡动态
6. ✅ 小组统计信息

### P3（第四阶段 - 激励功能）
7. ✅ 成就徽章系统
8. ✅ 打卡成功动画
9. ✅ 徽章解锁动画

---

## 九、技术实现要点

### 1. 组件结构
```vue
<template>
  <div class="check-in-container">
    <!-- 1. 打卡状态区 -->
    <CheckInStatusCard />

    <!-- 2. 个人统计 -->
    <PersonalStatsGrid />

    <!-- 3. 成就徽章 -->
    <BadgesSection />

    <!-- 4. 本周日历 -->
    <WeeklyCalendar />

    <!-- 5 & 6. 排行榜和动态 -->
    <div class="grid grid-cols-1 md:grid-cols-2">
      <LeaderboardCard />
      <RecentActivityCard />
    </div>
  </div>
</template>
```

### 2. 状态管理
```javascript
const checkInData = ref({
  todayCheckIn: null,
  stats: {},
  weeklyCalendar: [],
  badges: [],
  leaderboard: [],
  recentCheckIns: []
})

const isCheckingIn = ref(false)
```

### 3. API调用
```javascript
// 加载数据
const loadCheckInData = async () => {
  const response = await $fetch(...)
  checkInData.value = response.data
}

// 执行打卡
const doCheckIn = async () => {
  isCheckingIn.value = true
  try {
    const response = await $fetch(..., { method: 'POST' })
    // 显示成功动画
    // 如有新徽章，显示徽章动画
    // 重新加载数据
    await loadCheckInData()
  } finally {
    isCheckingIn.value = false
  }
}
```

---

## 十、用户体验细节

### 1. 加载状态
- 首次加载：显示骨架屏
- 打卡中：按钮显示加载动画，禁用点击

### 2. 错误处理
- 网络错误：显示重试按钮
- 重复打卡：友好提示"今天已打卡"
- 权限错误：提示加入小组后才能打卡

### 3. 空状态
- 刚加入小组：显示欢迎文案，引导首次打卡
- 小组无人打卡：显示鼓励文案

### 4. 微交互
- 按钮悬浮效果
- 数字变化动画
- 卡片展开/收起动画

---

## 十一、数据库更新

### 需要修改的表结构

#### StudyGroupCheckIn 表
```prisma
model StudyGroupCheckIn {
  id              String     @id @default(cuid())
  groupId         String
  group           StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  userId          String
  user            User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  checkInDate     String     // YYYY-MM-DD
  createdAt       DateTime   @default(now())  // 这个字段已经记录了具体时间

  @@unique([groupId, userId, checkInDate])
  @@index([groupId])
  @@index([userId])
  @@index([checkInDate])
}
```

**说明**：
- 不需要添加新字段
- `createdAt` 字段已经记录了打卡的具体时间
- `questionsCount` 和 `studyMinutes` 字段将被移除（简化设计）

---

## 十二、总结

这个重新设计的方案将打卡流程简化为**一键操作**，同时通过以下方式提升用户体验：

1. **简化操作**：移除所有表单输入，只需点击按钮
2. **即时反馈**：打卡后立即显示成功状态和动画
3. **游戏化激励**：连续天数、徽章系统激发坚持动力
4. **社交互动**：排行榜和动态创造学习氛围
5. **视觉友好**：清晰的布局和美观的UI设计

这个设计更符合现代应用的简洁理念，能够有效降低用户的操作成本，提高打卡完成率。
