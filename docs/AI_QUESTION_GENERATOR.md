# AI 智能题目生成功能使用指南

## 📋 功能概述

AI智能题目生成功能允许管理员快速批量生成高质量的考试题目，支持按领域生成或按官方考试比例生成，自动去重，确保题目多样性。

---

## 🎯 功能特性

### 1. 两种生成模式

#### 按领域生成
- 选择特定的Domain（如Domain 1、Domain 2等）
- 只为该领域生成题目
- 适合针对性补充某个领域的题库

#### 按考试比例生成
- 按照CALE官方考试比例自动分配题目
- Domain 1: 27%
- Domain 2: 17%
- Domain 3A: 16%
- Domain 3B: 8%
- Domain 3C: 5%
- Domain 4: 15%
- Domain 5: 11%
- 适合快速建立完整题库

### 2. 灵活的数量选择
- 10题：快速测试
- 20题：小批量补充
- 50题：中等批量
- 100题：大批量生成
- 200题：批量建库

### 3. 难度分布预设
- **简单模式**: 简单70% / 中等25% / 困难5%
- **标准模式**: 简单30% / 中等50% / 困难20%
- **困难模式**: 简单10% / 中等40% / 困难50%

### 4. 高级选项
- ✅ **避免重复**: AI检查题目相似度，过滤重复题目
- ✅ **详细解析**: 为每道题生成详细的答案解析
- ✅ **变化问法**: 同一知识点使用不同表述方式

---

## 🚀 使用方法

### 第一步：访问管理后台
1. 访问 `http://localhost:3001/admin`
2. 输入管理密码（默认：admin123）
3. 滚动到"AI 智能题目生成"部分

### 第二步：选择生成模式

#### 方式A：按领域生成
```
1. 点击"按领域生成"
2. 选择目标领域（如"評估病人"）
3. 选择生成数量（如20题）
4. 选择难度分布（如"标准"）
5. 点击"开始生成题目"
```

#### 方式B：按考试比例生成
```
1. 点击"按考试比例生成"
2. 选择总题目数量（如100题）
3. 系统自动按比例分配：
   - Domain 1: 27题
   - Domain 2: 17题
   - Domain 3A: 16题
   - Domain 3B: 8题
   - Domain 3C: 5题
   - Domain 4: 15题
   - Domain 5: 11题
4. 选择难度分布
5. 点击"开始生成题目"
```

### 第三步：等待生成
- 显示进度条
- 一般10-30秒完成
- 生成完成后显示结果

### 第四步：查看结果
```
成功生成 XX 道题目
（如有重复，会显示：过滤重复 X 道）
```

---

## 💡 生成示例

### Domain 1 - 患者评估类题目
```
题目：
患者45岁女性，主诉头痛伴眩晕3个月。
舌红少苔，脉弦细数。
根据四诊合参，最可能的诊断是：

A. 肝阳上亢
B. 气血两虚
C. 肝肾阴虚 ✓
D. 痰浊中阻

解析：
舌红少苔提示阴虚，脉弦细数符合肝肾阴虚证候。
头痛眩晕是肝肾阴虚导致虚阳上扰的表现。
```

### Domain 3A - 选穴类题目
```
题目：
治疗胃痛，根据"腑会中脘"原则，应首选：

A. 中脘 ✓
B. 足三里
C. 内关
D. 公孙

解析：
中脘为腑会，是治疗六腑病证的要穴，
对胃痛有特殊疗效。
```

### Domain 3B - 针刺技术类题目
```
题目：
内关穴的标准定位是：

A. 腕横纹上2寸，掌长肌腱与桡侧腕屈肌腱之间 ✓
B. 腕横纹上3寸，掌长肌腱与桡侧腕屈肌腱之间
C. 腕横纹上2寸，桡侧腕屈肌腱桡侧缘
D. 腕横纹上3寸，尺侧腕屈肌腱尺侧缘

解析：
内关穴位于前臂掌侧，腕横纹上2寸，
掌长肌腱与桡侧腕屈肌腱之间。
```

### Domain 4 - 中药类题目
```
题目：
六味地黄丸的主要功效是：

A. 滋补肝肾 ✓
B. 温补肾阳
C. 养血柔肝
D. 健脾益气

解析：
六味地黄丸以熟地黄为君药，
具有滋补肝肾之阴的功效。
```

### Domain 5 - 法规类题目
```
题目：
根据加州法律，针灸师的执业范围不包括：

A. 针刺治疗
B. 中药配方
C. 开具西药处方 ✓
D. 推拿按摩

解析：
加州针灸师可以进行针灸治疗、配制中药和推拿，
但不能开具西药处方。
```

---

## 🎨 题目生成原理

### 1. 基于官方大纲
- 所有题目基于CALE官方考试大纲
- 覆盖所有Task和Knowledge Statement
- 符合考试范围和难度要求

### 2. 模板系统
- 每个Domain有多个题目模板
- 每个模板包含多种问法变体
- 随机组合生成新题目

### 3. 变量替换
```typescript
模板: "患者{age}岁{gender}，主诉{symptom1}伴{symptom2}..."

变量池:
- age: [25, 35, 45, 55, 65]
- gender: [男, 女]
- symptom1: [头痛, 眩晕, 失眠, 心悸...]
- symptom2: [气短, 乏力, 口苦, 纳差...]

生成: "患者45岁女性，主诉头痛伴眩晕..."
```

### 4. 智能选项生成
- 正确答案基于中医理论
- 干扰项选择相似但错误的选项
- 避免明显错误的选项

### 5. 去重机制
- 检查题目文本是否重复
- 避免与现有题目冲突
- 最大化题目多样性

---

## 📊 适用场景

### 场景1：快速建立题库
```
情况：新系统，题库为空
方案：
1. 按考试比例生成200题
2. 难度选择"标准"
3. 开启所有高级选项
4. 一次性建立基础题库
```

### 场景2：补充特定领域
```
情况：Domain 3A 题目较少
方案：
1. 按领域生成，选择Domain 3A
2. 生成50题
3. 难度选择"标准"
4. 针对性补充
```

### 场景3：增加难题
```
情况：需要更多困难题目
方案：
1. 按考试比例生成100题
2. 难度选择"困难"（10%简单/40%中等/50%困难）
3. 提升整体难度
```

### 场景4：日常维护
```
情况：定期更新题库
方案：
1. 每周生成20-50题
2. 轮流选择不同Domain
3. 保持题库新鲜度
```

---

## ⚙️ 技术实现

### API端点
```
POST /api/ai/generate-questions

请求体:
{
  "mode": "domain" | "proportion",
  "categoryId": "xxx",  // domain模式必填
  "count": 20,
  "difficultyDistribution": {
    "easy": 30,
    "medium": 50,
    "hard": 20
  },
  "avoidDuplicates": true,
  "includeExplanations": true,
  "varyQuestionFormat": true
}

响应:
{
  "success": true,
  "generated": 20,
  "saved": 18,
  "duplicates": 2,
  "message": "成功生成 18 道题目，过滤重复 2 道"
}
```

### 数据结构
```typescript
interface GeneratedQuestion {
  question: string          // 题目内容
  options: string[]         // JSON数组
  correctAnswer: string     // 正确答案
  explanation: string       // 解析
  difficulty: string        // easy/medium/hard
  type: 'multiple_choice'   // 题型
  categoryId: string        // 所属分类
  examType: 'cale'          // 考试类型
  source: 'AI Generated'    // 来源标记
}
```

---

## 📈 质量保证

### 1. 内容准确性
- 基于官方考试大纲
- 答案符合中医理论
- 解析清晰准确

### 2. 题目多样性
- 多种问法模板
- 随机变量组合
- 避免重复

### 3. 难度合理
- 简单题：基础概念
- 中等题：综合应用
- 困难题：深度分析

### 4. 格式规范
- 统一的题目结构
- 标准的选项格式（A. B. C. D.）
- 完整的答案解析

---

## ⚠️ 注意事项

1. **生成数量限制**
   - 单次建议不超过200题
   - 避免数据库压力

2. **去重机制**
   - 只检查题目文本
   - 不检查选项和解析
   - 相似题目可能通过

3. **质量检查**
   - AI生成题目建议人工审核
   - 特别检查专业术语准确性
   - 及时修正错误

4. **性能考虑**
   - 大批量生成需要时间
   - 避免频繁生成
   - 建议分批进行

5. **题库平衡**
   - 定期检查各Domain题目数量
   - 保持合理比例
   - 避免某个领域题目过多

---

## 🔧 故障排除

### 问题1：生成失败
```
原因：数据库连接问题
解决：检查Prisma连接，重启服务器
```

### 问题2：所有题目都被去重
```
原因：该领域题目已达饱和
解决：
- 关闭"避免重复"选项
- 或清理部分旧题目
```

### 问题3：生成速度慢
```
原因：题目数量过多
解决：
- 减少单次生成数量
- 分批生成
```

### 问题4：题目质量不佳
```
原因：模板不够丰富
解决：
- 联系开发团队
- 提供反馈
- 优化模板库
```

---

## 📚 最佳实践

### 建议的题库规模
```
Domain 1 (27%): 100-150题
Domain 2 (17%): 60-90题
Domain 3A (16%): 60-80题
Domain 3B (8%): 30-50题
Domain 3C (5%): 20-30题
Domain 4 (15%): 50-80题
Domain 5 (11%): 40-60题

总计: 360-540题
```

### 建库流程
```
第一周：
- 按比例生成200题（基础）
- 难度：标准

第二周：
- 每个Domain补充20-30题
- 难度：混合

第三周：
- 生成50题困难题
- 提升难度梯度

第四周：
- 人工审核
- 修正错误
- 补充不足
```

### 维护计划
```
日常：
- 每天生成10题
- 轮流各个Domain

每周：
- 审核新题质量
- 删除重复或错误题目
- 补充薄弱领域

每月：
- 统计各Domain题目数
- 调整生成策略
- 优化难度分布
```

---

## 🎓 进阶技巧

### 1. 混合策略
```
结合两种模式：
1. 先按比例生成100题（建立基础）
2. 再按领域补充薄弱部分
3. 最后生成困难题提升梯度
```

### 2. 分批生成
```
避免一次性生成过多：
1. 第一批：50题（标准难度）
2. 检查质量
3. 第二批：50题（调整参数）
4. 逐步优化
```

### 3. A/B测试
```
测试不同参数效果：
1. 生成20题（简单模式）
2. 生成20题（困难模式）
3. 对比学生反馈
4. 选择最佳配置
```

---

**最后更新**: 2025-10-19
**版本**: v1.0.0
**维护**: Claude Code Team
